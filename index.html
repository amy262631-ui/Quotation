<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å·¥ç¨‹å ±åƒ¹ç³»çµ±ï¼ˆHerhsin & SinChangï¼‰- V23</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React 18 -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Excel Export -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

    <style>
        body {
            background: #f3f4f6;
            font-family: "Microsoft JhengHei", sans-serif;
        }

        /* é è¦½å€ */
        .live-preview-box {
            background: #fff;
            border: 2px dashed #00bfff;
            padding: 20px;
            margin-top: 40px;
        }
        .live-preview-box .print-page {
            max-width: 210mm;
            margin: auto;
            padding: 16px;
            border: 1px solid #ccc;
        }

        /* åˆ—å°æ¨¡å¼ */
        @media print {

            .no-print {
                display: none !important;
            }

            #root {
                display: none !important;
            }

            #printContainer {
                display: block !important;
                position: fixed;
                top: 0;
                left: 0;
                width: 210mm;
                min-height: 297mm;
                padding: 12mm;
                box-sizing: border-box;
                background: white;
                z-index: 9999;
            }

            .print-image {
                max-width: 90%;
                margin-top: 5px;
            }
        }

        #printContainer {
            display: none;
        }
    </style>
</head>

<body>
<div id="root"></div>
<div id="printContainer"></div>

<script type="text/babel">
/***************************************************
 * P1 â€” å…¬å¸è³‡æ–™ / å‚™è¨» / ä»˜æ¬¾æ¢ä»¶ / å ±åƒ¹æ¨¡å¼
 ***************************************************/
const COMPANY_DATA = {
  herhsin: {
    name: "ä½•é‘«å¯¦æ¥­è‚¡ä»½æœ‰é™å…¬å¸",
    tel: "07-6521927",
    fax: "07-6517994",
    email: "affairs@herhsin.com",
    address: "831é«˜é›„å¸‚å¤§å¯®å€é³³å±äºŒè·¯383-8è™Ÿ",

    /* â­ å ±åƒ¹ç« ï¼šä½¿ç”¨ä½  GitHub åœ–ç‰‡ */
    stamp: "https://amy262631-ui.github.io/Quotation/herhsin_stamp.JPG",
    prefix: "QH",
  },
  sinchang: {
    name: "è–ªæ˜Œè‚¡ä»½æœ‰é™å…¬å¸",
    tel: "07-6521927",
    fax: "07-6517994",
    email: "affairs@herhsin.com",
    address: "831é«˜é›„å¸‚å¤§å¯®å€é³³å±äºŒè·¯383-8è™Ÿ",

    /* â­ å ±åƒ¹ç« ï¼šä½¿ç”¨ä½  GitHub åœ–ç‰‡ */
    stamp: "https://amy262631-ui.github.io/Quotation/sinchang_stamp.JPG",
    prefix: "QS",
  },
};

// é è¨­å‚™è¨»
const DEFAULT_NOTES = `1. æœ¬å ±åƒ¹æœªå«åŠ å€¼ç¨…ã€‚
2. å®‰è£æ–½ä½œæ™‚éœ€æ³¨æ„ç¾å ´ä½œæ¥­ç’°å¢ƒã€‚
3. å ±åƒ¹å–®æœ‰æ•ˆæœŸé™ç‚º 15 å¤©ã€‚
4. è‹¥é‡ä¸å¯æŠ—åŠ›å› ç´ é€ æˆå»¶èª¤ï¼Œå·¥æœŸé †å»¶ã€‚
5. æ–™ä»¶é ˆç”±æœ¬å…¬å¸æä¾›èˆ‡å®‰è£ï¼Œå¦å‰‡ä¸åœ¨ä¿å›ºç¯„åœå…§ã€‚
6. ä»˜æ¬¾æ¢ä»¶ä¾é›™æ–¹åˆç´„å…§å®¹ç‚ºæº–ã€‚`;

// é è¨­ä»˜æ¬¾æ¢ä»¶
const DEFAULT_PAYMENT = `è¨‚é‡‘ï¼š40%
è£½ä½œå®Œæˆï¼š30%
å®‰è£å®Œæˆï¼š20%
å®Œå·¥é©—æ”¶ï¼š10%`;

// å ±åƒ¹æ¨¡å¼
const QUOTE_MODES = [
  {
    id: "modeA",
    name: "æ‹Œåˆæ©Ÿæ¼æ¼¿æ›´æ›",
    description: "é©ç”¨æ‹Œåˆæ©Ÿç¶­ä¿®ã€æ¼æ¼¿è™•ç†ç­‰ã€‚",
    defaultItems: [],
    defaultNotes: DEFAULT_NOTES,
    defaultPayment: DEFAULT_PAYMENT,
  },
  {
    id: "modeB",
    name: "è¨­å‚™éŠ·å”®",
    description: "é©ç”¨å‚™å“ã€å–®æ©ŸéŠ·å”®èˆ‡å®‰è£ã€‚",
    defaultItems: [],
    defaultNotes: DEFAULT_NOTES,
    defaultPayment: DEFAULT_PAYMENT,
  },
  {
    id: "modeC",
    name: "è¨­å‚™æ›´æ›å·¥ç¨‹",
    description: "é©ç”¨æ•´æ©Ÿæ›´æ–°ã€æ–™ä»¶æ›´æ›å·¥ç¨‹ã€‚",
    defaultItems: [],
    defaultNotes: DEFAULT_NOTES,
    defaultPayment: DEFAULT_PAYMENT,
  },
];

/***************************************************
 * P2 â€” å·¥å…·å‡½å¼ï¼ˆå« Google Sheet è¦æ ¼å“è®€å–åŠŸèƒ½ï¼‰
 ***************************************************/
function uuid() {
  return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function (c) {
    const r = (Math.random() * 16) | 0;
    const v = c === "x" ? r : (r & 0x3) | 0x8;
    return v.toString(16);
  });
}

function formatMoney(n) {
  return Number(n || 0).toLocaleString("zh-TW", {
    minimumFractionDigits: 0,
  });
}

function calcAmount(item) {
  return Number(item.qty || 0) * Number(item.price || 0);
}

function calcTotal(items) {
  return items.reduce((sum, it) => {
    let main = calcAmount(it);
    let subs = (it.subItems || [])
      .filter((s) => s.type === "item")
      .reduce((s, x) => s + calcAmount(x), 0);
    return sum + main + subs;
  }, 0);
}

function calcNegotiated(total, discountPercent, custom) {
  if (Number(custom) > 0) return Number(custom);
  if (Number(discountPercent) > 0)
    return Math.round(total * (1 - Number(discountPercent) / 100));
  return total;
}

/***************************************************
 *  Google Sheet CSV è®€å–ï¼ˆæ”¯æ´ä¸­æ–‡æ¬„ä½ï¼‰
 ***************************************************/
async function loadCSV(url) {
  try {
    const res = await fetch(url);
    const text = await res.text();

    const rows = text.split("\n").map((r) => r.trim());
    const header = rows[0].split(",").map((h) => h.trim());

    return rows.slice(1).map((row) => {
      const cols = row.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g);
      const obj = {};

      header.forEach((h, i) => {
        let v = cols[i] ? cols[i].replace(/"/g, "") : "";

        obj[h] = v; // â­ ç›´æ¥ä¿ç•™ä¸­æ–‡æ¬„ä½ï¼Œä¾‹å¦‚ã€Œå“åã€ã€Œè¦æ ¼ã€ã€Œç”¨æ–™1ã€
      });

      return obj;
    });
  } catch (err) {
    console.error("CSV è¼‰å…¥éŒ¯èª¤:", err);
    return [];
  }
}
/***************************************************
 * P3 â€” AppContextï¼ˆè³‡æ–™ä¸­å¿ƒï¼‰
 ***************************************************/
const AppContext = React.createContext();

function AppProvider({ children }) {

  /**********************
   * å…¨åŸŸç‹€æ…‹
   **********************/
  const [company, setCompany] = React.useState("herhsin"); // ä½•é‘« / è–ªæ˜Œ
  const [quotes, setQuotes] = React.useState([]); // å ±åƒ¹å–®æ¸…å–®
  const [activeQuoteId, setActiveQuoteId] = React.useState(null); // ç›®å‰ç·¨è¼¯ä¸­ ID

  const [specItems, setSpecItems] = React.useState([]); // Google Sheet è¦æ ¼å“è³‡æ–™

  // â­ ä½ çš„ Google Sheetï¼ˆCSV æ ¼å¼ï¼‰
  const SPEC_CSV_URL =
    "https://docs.google.com/spreadsheets/d/e/2PACX-1vQHQN_nMBB7l72PSD8omOO55UYRlIClUGEDgtzYzTKK-5fvRWIZowcdnMHvkkwJbdz7krhIiRc00sye/pub?gid=0&single=true&output=csv";

  /**********************
   * 1ï¸âƒ£ åˆå§‹åŒ–ï¼šè®€å– localStorage
   **********************/
  React.useEffect(() => {
    const saved = localStorage.getItem("HERHSIN_QUOTES");
    if (!saved) return;

    try {
      const data = JSON.parse(saved);
      if (Array.isArray(data)) {
        setQuotes(data);
        if (data.length > 0) setActiveQuoteId(data[0].id);
      }
    } catch (e) {
      console.error("è®€å– localStorage å¤±æ•—", e);
    }
  }, []);

  /**********************
   * 2ï¸âƒ£ è‡ªå‹•å¯«å› localStorage
   **********************/
  React.useEffect(() => {
    localStorage.setItem("HERHSIN_QUOTES", JSON.stringify(quotes));
  }, [quotes]);

  /**********************
   * 3ï¸âƒ£ è¼‰å…¥ Google Sheet è¦æ ¼å“è³‡æ–™
   **********************/
  const loadSpecItems = React.useCallback(() => {
    loadCSV(SPEC_CSV_URL).then((data) => {
      console.log("ğŸ“Œ Google Sheet å·²è¼‰å…¥ï¼š", data);
      setSpecItems(data);
    });
  }, []);

  React.useEffect(() => {
    loadSpecItems(); // é¦–æ¬¡è¼‰å…¥
  }, [loadSpecItems]);


  /**********************
   * 4ï¸âƒ£ å»ºç«‹æ–°å ±åƒ¹å–®
   **********************/
  const createQuote = React.useCallback(
    (modeId = null) => {
      const mode = QUOTE_MODES.find((m) => m.id === modeId);

      const newQuote = {
        id: uuid(),
        company: company, // â­ ä½•é‘« / è–ªæ˜Œ
        quoteNo: generateQuoteNo(company), // â­ è‡ªå‹•å¥—ç”¨å…¬å¸åˆ¥å½±éŸ¿ç·¨è™Ÿ
        title: mode ? mode.name : "æœªå‘½åå·¥ç¨‹",

        customerName: "",
        contact: "",
        phone: "",
        location: "",

        date: formatDate(),
        items: [],

        notes: mode ? mode.defaultNotes : DEFAULT_NOTES,
        payment: mode ? mode.defaultPayment : DEFAULT_PAYMENT,

        discountPercent: 0,
        negotiatedPrice: 0,
      };

      // å¦‚æœæ¨¡å¼æœ‰é è¨­é …ç›® â†’ åŠ å…¥ id
      if (mode && mode.defaultItems.length > 0) {
        newQuote.items = mode.defaultItems.map((it) => ({
          ...it,
          id: uuid(),
          subItems: [],
        }));
      }

      setQuotes((prev) => [newQuote, ...prev]);
      setActiveQuoteId(newQuote.id);
    },
    [company]
  );

  /**********************
   * 5ï¸âƒ£ åˆªé™¤å ±åƒ¹å–®
   **********************/
  const deleteQuote = React.useCallback(
    (id) => {
      setQuotes((prev) => {
        const newList = prev.filter((q) => q.id !== id);
        if (id === activeQuoteId) {
          setActiveQuoteId(newList.length > 0 ? newList[0].id : null);
        }
        return newList;
      });
    },
    [activeQuoteId]
  );

  /**********************
   * 6ï¸âƒ£ æ›´æ–°å ±åƒ¹å–®
   **********************/
  const updateQuote = React.useCallback((id, data) => {
    setQuotes((prev) =>
      prev.map((q) => (q.id === id ? { ...q, ...data } : q))
    );
  }, []);

  /**********************
   * 7ï¸âƒ£ å¥—ç”¨æ¨¡å¼åˆ°ç¾æœ‰å ±åƒ¹å–®
   **********************/
  const applyMode = React.useCallback(
    (modeId) => {
      const mode = QUOTE_MODES.find((m) => m.id === modeId);
      if (!mode || !activeQuoteId) return;

      updateQuote(activeQuoteId, {
        title: mode.name,
        notes: mode.defaultNotes,
        payment: mode.defaultPayment,

        items: mode.defaultItems.map((it) => ({
          ...it,
          id: uuid(),
          subItems: [],
        })),
      });
    },
    [activeQuoteId, updateQuote]
  );

  /**********************
   * 8ï¸âƒ£ è®Šæ›´å…¬å¸ â†’ è‡ªå‹•æ›å°ç«  ï¼‹ è‡ªå‹•æ›å ±åƒ¹å–®ç·¨è™Ÿ
   **********************/
  const handleSetCompany = (newCompany) => {
    setCompany(newCompany);

    if (activeQuoteId) {
      updateQuote(activeQuoteId, {
        company: newCompany,
        quoteNo: generateQuoteNo(newCompany), // â­æ›å…¬å¸ â†’ æ›ç·¨è™Ÿ
      });
    }
  };

  /**********************
   * 9ï¸âƒ£ æä¾› Context çµ¦å…¨ç³»çµ±
   **********************/
  const activeQuote = quotes.find((q) => q.id === activeQuoteId);

  const value = {
    company,
    setCompany: handleSetCompany,

    quotes,
    createQuote,
    deleteQuote,
    updateQuote,

    activeQuote,
    activeQuoteId,
    setActiveQuoteId,

    specItems, // â­ å…¨ç³»çµ±å¯ç”¨çš„è¦æ ¼å“è³‡æ–™
    loadSpecItems,

    applyMode,
  };

  // Debug ç”¨ï¼ˆå¯åˆªé™¤ï¼‰
  window.__APP_CONTEXT__ = value;

  return (
    <AppContext.Provider value={value}>{children}</AppContext.Provider>
  );
}
/***************************************************
 * P4 â€” å·¦å´å…ƒä»¶ï¼šå…¬å¸åˆ‡æ› / æ¨¡å¼é¸æ“‡ / å ±åƒ¹å–®åˆ—è¡¨
 ***************************************************/


/***********************
 * 4-1 â€” å…¬å¸åˆ‡æ›ï¼ˆä½•é‘« / è–ªæ˜Œï¼‰
 ***********************/
function CompanySelector() {
    const { company, setCompany } = React.useContext(AppContext);

    return (
        <div className="mb-6 no-print">
            <div className="font-bold mb-2">é¸æ“‡å…¬å¸</div>

            <div className="flex gap-2">
                {/* ä½•é‘« */}
                <button
                    className={`px-3 py-1 rounded ${
                        company === "herhsin"
                            ? "bg-blue-600 text-white"
                            : "bg-gray-300 hover:bg-gray-400"
                    }`}
                    onClick={() => setCompany("herhsin")}
                >
                    ä½•é‘«å¯¦æ¥­
                </button>

                {/* è–ªæ˜Œ */}
                <button
                    className={`px-3 py-1 rounded ${
                        company === "sinchang"
                            ? "bg-blue-600 text-white"
                            : "bg-gray-300 hover:bg-gray-400"
                    }`}
                    onClick={() => setCompany("sinchang")}
                >
                    è–ªæ˜Œè‚¡ä»½æœ‰é™å…¬å¸
                </button>
            </div>
        </div>
    );
}



/***********************
 * 4-2 â€” æ¨¡å¼é¸æ“‡ï¼ˆMode A/B/Cï¼‰
 ***********************/
function ModeSelector() {
    const { createQuote, applyMode } = React.useContext(AppContext);

    const [selectedMode, setSelectedMode] = React.useState("");
    const [applyToNew, setApplyToNew] = React.useState(true);

    return (
        <div className="mb-6 border-b border-gray-300 pb-4 no-print">

            <div className="font-bold mb-2">æ¨¡å¼å¥—ç”¨</div>

            {/* æ–°å»º / å¥—ç”¨ç›®å‰ */}
            <div className="flex gap-2 mb-3">
                <button
                    className={`px-3 py-1 text-sm rounded ${
                        applyToNew
                            ? "bg-green-600 text-white"
                            : "bg-gray-300"
                    }`}
                    onClick={() => setApplyToNew(true)}
                >
                    æ–°å»ºå ±åƒ¹å–®
                </button>

                <button
                    className={`px-3 py-1 text-sm rounded ${
                        !applyToNew
                            ? "bg-orange-600 text-white"
                            : "bg-gray-300"
                    }`}
                    onClick={() => setApplyToNew(false)}
                >
                    å¥—ç”¨è‡³ç•¶å‰
                </button>
            </div>

            {/* æ¨¡å¼ä¸‹æ‹‰é¸å–® */}
            <select
                className="w-full border p-2 mb-3 rounded"
                value={selectedMode}
                onChange={(e) => setSelectedMode(e.target.value)}
            >
                <option value="" disabled>
                    è«‹é¸æ“‡å ±åƒ¹æ¨¡å¼
                </option>

                {QUOTE_MODES.map((md) => (
                    <option key={md.id} value={md.id}>
                        {md.name} â€” {md.description}
                    </option>
                ))}
            </select>

            {/* å¥—ç”¨ */}
            <button
                className="w-full bg-blue-500 text-white py-2 rounded disabled:opacity-50"
                disabled={!selectedMode}
                onClick={() => {
                    if (!selectedMode) return;
                    applyToNew
                        ? createQuote(selectedMode)
                        : applyMode(selectedMode);
                    setSelectedMode("");
                }}
            >
                å¥—ç”¨æ¨¡å¼
            </button>
        </div>
    );
}



/***********************
 * 4-3 â€” å ±åƒ¹å–®åˆ—è¡¨ï¼ˆå·¦å´ï¼‰
 ***********************/
function QuoteList() {
    const {
        quotes,
        deleteQuote,
        activeQuoteId,
        setActiveQuoteId,
    } = React.useContext(AppContext);

    return (
        <div className="no-print">
            <div className="font-bold mb-2">å ±åƒ¹å–®åˆ—è¡¨</div>

            <div className="space-y-2 max-h-[50vh] overflow-y-auto pr-2">

                {quotes.length === 0 && (
                    <div className="text-gray-400 text-sm">
                        å°šç„¡å ±åƒ¹å–®ï¼Œè«‹å»ºç«‹ä¸€ç­†ã€‚
                    </div>
                )}

                {quotes.map((q) => {
                    const isActive = q.id === activeQuoteId;
                    return (
                        <div
                            key={q.id}
                            className={`p-3 border rounded cursor-pointer flex justify-between items-center ${
                                isActive
                                    ? "bg-blue-100 border-blue-500"
                                    : "bg-white hover:bg-gray-100"
                            }`}
                            onClick={() => setActiveQuoteId(q.id)}
                        >
                            <div>
                                <div className="font-semibold text-sm">
                                    {q.title || "æœªå‘½åå·¥ç¨‹"}
                                </div>
                                <div className="text-gray-500 text-xs">
                                    {q.quoteNo}
                                </div>
                            </div>

                            {/* åˆªé™¤ */}
                            <button
                                className="text-red-500 text-xs hover:underline"
                                onClick={(e) => {
                                    e.stopPropagation();
                                    if (
                                        confirm(
                                            "ç¢ºå®šè¦åˆªé™¤æ­¤å ±åƒ¹å–®ï¼Ÿ"
                                        )
                                    ) {
                                        deleteQuote(q.id);
                                    }
                                }}
                            >
                                åˆªé™¤
                            </button>
                        </div>
                    );
                })}
            </div>
        </div>
    );
}
/***************************************************
 * P5 â€” å ±åƒ¹å–®ç·¨è¼¯ä¸»å…ƒä»¶ (A5-1ï¼šä¸»å®¹å™¨)
 ***************************************************/
function QuoteEditor() {
    const { activeQuote, updateQuote } = React.useContext(AppContext);

    if (!activeQuote) {
        return (
            <div className="p-8 text-center text-gray-500 text-xl">
                è«‹å¾å·¦å´é¸æ“‡ä¸€å€‹å ±åƒ¹å–®æˆ–æ–°å»ºä¸€å€‹å ±åƒ¹å–®ã€‚
            </div>
        );
    }

    // ç”¨æ–¼åˆ—å°çš„éš±è—ç‰ˆé¢
    const printRef = React.useRef(null);

    // æ›´æ–°å ±åƒ¹å–®æ¬„ä½
    const handleChange = (field, value) => {
        updateQuote(activeQuote.id, { [field]: value });
    };

    const totalAmount = calcTotal(activeQuote.items);
    const negotiatedAmount = calcNegotiated(
        totalAmount,
        activeQuote.discountPercent,
        activeQuote.negotiatedPrice
    );

    return (
        <div className="quote-editor-root-container">

            {/* ====== ç·¨è¼¯å™¨å€ï¼ˆå¯è¦‹å€ï¼‰ ====== */}
            <div className="p-6 bg-gray-100 rounded-lg shadow-xl no-print">
                <h1 className="text-2xl font-bold mb-4 border-b pb-2">
                    ç·¨è¼¯å ±åƒ¹å–®ï¼š{activeQuote.title || "æœªå‘½å"}
                </h1>

                {/* === åŸºæœ¬è³‡æ–™ === */}
                <div className="bg-white p-4 rounded mb-6 grid grid-cols-2 gap-4 text-sm shadow-inner">

                    {/* å ±åƒ¹å–®ç·¨è™Ÿï¼ˆä¸å¯ç·¨è¼¯ï¼‰ */}
                    <div className="col-span-2 flex items-center">
                        <label className="font-semibold w-1/4">å ±åƒ¹å–®ç·¨è™Ÿï¼š</label>
                        <div className="text-blue-700 font-mono text-base">
                            {activeQuote.quoteNo}
                        </div>
                    </div>

                    {/* å·¥ç¨‹åç¨± */}
                    <div className="col-span-2">
                        <label className="font-semibold block mb-1">å·¥ç¨‹åç¨±ï¼š</label>
                        <input
                            type="text"
                            className="w-full border p-2 rounded"
                            value={activeQuote.title}
                            onChange={(e) => handleChange("title", e.target.value)}
                        />
                    </div>

                    <div>
                        <label className="font-semibold block mb-1">å®¢æˆ¶åç¨±ï¼š</label>
                        <input
                            type="text"
                            className="w-full border p-2 rounded"
                            value={activeQuote.customerName}
                            onChange={(e) => handleChange("customerName", e.target.value)}
                        />
                    </div>

                    <div>
                        <label className="font-semibold block mb-1">è¯çµ¡äººï¼š</label>
                        <input
                            type="text"
                            className="w-full border p-2 rounded"
                            value={activeQuote.contact}
                            onChange={(e) => handleChange("contact", e.target.value)}
                        />
                    </div>

                    <div>
                        <label className="font-semibold block mb-1">é›»è©±ï¼š</label>
                        <input
                            type="text"
                            className="w-full border p-2 rounded"
                            value={activeQuote.phone}
                            onChange={(e) => handleChange("phone", e.target.value)}
                        />
                    </div>

                    <div>
                        <label className="font-semibold block mb-1">å ±åƒ¹æ—¥æœŸï¼š</label>
                        <input
                            type="date"
                            className="w-full border p-2 rounded"
                            value={activeQuote.date}
                            onChange={(e) => handleChange("date", e.target.value)}
                        />
                    </div>

                    <div className="col-span-2">
                        <label className="font-semibold block mb-1">å·¥ç¨‹åœ°é»ï¼š</label>
                        <input
                            type="text"
                            className="w-full border p-2 rounded"
                            value={activeQuote.location}
                            onChange={(e) => handleChange("location", e.target.value)}
                        />
                    </div>

                    {/* ç¸½è¨ˆé‡‘é¡ */}
                    <div className="col-span-2 bg-blue-50 p-3 rounded">
                        <div className="text-xl font-bold text-blue-700">
                            ç¸½è¨ˆé‡‘é¡ï¼ˆæœªç¨…ï¼‰ï¼šNT$ {formatMoney(totalAmount)}
                        </div>
                    </div>

                    {/* æŠ˜æ‰£ / è­°åƒ¹ */}
                    <div>
                        <label className="font-semibold block mb-1">æŠ˜æ‰£ï¼ˆ%ï¼‰ï¼š</label>
                        <input
                            type="number"
                            min="0"
                            max="100"
                            className="w-full border p-2 rounded"
                            value={activeQuote.discountPercent}
                            onChange={(e) =>
                                handleChange("discountPercent", Number(e.target.value))
                            }
                        />
                    </div>

                    <div>
                        <label className="font-semibold block mb-1">è­°åƒ¹å¾Œç¸½åƒ¹ï¼š</label>
                        <input
                            type="number"
                            min="0"
                            className="w-full border p-2 rounded"
                            value={activeQuote.negotiatedPrice}
                            onChange={(e) =>
                                handleChange("negotiatedPrice", Number(e.target.value))
                            }
                        />
                    </div>

                    <div className="col-span-2 bg-red-50 p-3 rounded border-l-4 border-red-500">
                        <div className="text-xl font-bold text-red-700">
                            æœ€çµ‚å ±åƒ¹ï¼ˆæœªç¨…ï¼‰ï¼šNT$ {formatMoney(negotiatedAmount)}
                        </div>
                    </div>
                </div>

                {/* ================== å ±åƒ¹é …ç›®åˆ—è¡¨ï¼ˆä¸‹ä¸€æ®µ A5-2ï¼‰ ================== */}
                <QuoteItemList />

                {/* === å‚™è¨» / ä»˜æ¬¾æ¢ä»¶ === */}
                <div className="grid grid-cols-2 gap-6 mt-6">
                    <div>
                        <h3 className="font-bold mb-1">å‚™è¨»ï¼ˆä¸å«ç¨…ï¼‰ï¼š</h3>
                        <textarea
                            rows="7"
                            className="w-full border p-2 rounded"
                            value={activeQuote.notes}
                            onChange={(e) => handleChange("notes", e.target.value)}
                        />
                    </div>

                    <div>
                        <h3 className="font-bold mb-1">ä»˜æ¬¾æ¢ä»¶ï¼š</h3>
                        <textarea
                            rows="7"
                            className="w-full border p-2 rounded"
                            value={activeQuote.payment}
                            onChange={(e) => handleChange("payment", e.target.value)}
                        />
                    </div>
                </div>

                {/* === åŒ¯å‡º / åˆ—å°æŒ‰éˆ•ï¼ˆPDF / Printï¼‰ === */}
                <div className="flex justify-between mt-8 pt-4 border-t">
                    <ExportButton />
                    <PrintButton printRef={printRef} />
                </div>

                {/* === å¯¦æ™‚é è¦½ï¼ˆA4 æ¨¡æ“¬ï¼‰ === */}
                <div className="live-preview-box">
                    <h3 className="text-center text-xl font-bold text-blue-700 mb-4">
                        å ±åƒ¹å–®é è¦½ï¼ˆéåˆ—å°å°ºå¯¸ï¼‰
                    </h3>

                    <div className="print-page">
                        <PrintLayout
                            quote={activeQuote}
                            totalAmount={totalAmount}
                            negotiatedAmount={negotiatedAmount}
                        />
                    </div>
                </div>
            </div>

            {/* ====== éš±è—åˆ—å°å€ ====== */}
            <div
                ref={printRef}
                style={{ position: "absolute", top: -9999, left: -9999 }}
            >
                <PrintLayout
                    quote={activeQuote}
                    totalAmount={totalAmount}
                    negotiatedAmount={negotiatedAmount}
                />
            </div>
        </div>
    );
}
/***************************************************
 * A5-2 â€” å ±åƒ¹é …ç›®åˆ—è¡¨ QuoteItemList
 ***************************************************/
function QuoteItemList() {
    const { activeQuote, updateQuote } = React.useContext(AppContext);

    if (!activeQuote) return null;

    const addItem = () => {
        const newItem = {
            id: uuid(),
            name: "",
            specMain: "",
            specMaterial: "",
            qty: 1,
            unit: "",
            price: 0,
            remarks: "",
            subItems: []
        };

        updateQuote(activeQuote.id, {
            items: [...activeQuote.items, newItem]
        });
    };

    const deleteItem = (itemId) => {
        updateQuote(activeQuote.id, {
            items: activeQuote.items.filter(i => i.id !== itemId)
        });
    };

    const updateItem = (itemId, data) => {
        updateQuote(activeQuote.id, {
            items: activeQuote.items.map(i =>
                i.id === itemId ? { ...i, ...data } : i
            )
        });
    };

    return (
        <div className="bg-white p-4 rounded shadow mt-6 no-print">
            <div className="flex justify-between items-center mb-4">
                <h2 className="text-xl font-bold">å ±åƒ¹é …ç›®åˆ—è¡¨</h2>

                {/* æ–°å¢ä¸»é …ç›® */}
                <button
                    className="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700"
                    onClick={addItem}
                >
                    + æ–°å¢é …ç›®
                </button>
            </div>

            {/* ä¸»é …ç›®åˆ—è¡¨ */}
            <div className="space-y-4">
                {activeQuote.items.map((item, index) => (
                    <QuoteItem
                        key={item.id}
                        item={item}
                        index={index}
                        updateItem={updateItem}
                        deleteItem={deleteItem}
                    />
                ))}
            </div>
        </div>
    );
}
/***************************************************
 * A5-2 â€” å ±åƒ¹ä¸»é …ç›® QuoteItemï¼ˆå« Google Sheet å¸¶å…¥ï¼‰
 ***************************************************/
function QuoteItem({ item, index, updateItem, deleteItem }) {
    const { specItems } = React.useContext(AppContext);

    const [keyword, setKeyword] = React.useState("");
    const [showDropdown, setShowDropdown] = React.useState(false);

    /** ğŸ” Google Sheet é—œéµå­—æœå°‹ */
    const filteredSpec = React.useMemo(() => {
        if (!keyword) return [];
        return specItems.filter(row =>
            row.å“å?.includes(keyword) ||
            row.è¦æ ¼?.includes(keyword)
        ).slice(0, 20); // æœ€å¤šé¡¯ç¤º 20 ç­†
    }, [keyword, specItems]);


    /** ğŸŸ¦ é¸æ“‡ Google Sheet é …ç›® â†’ è‡ªå‹•å¸¶å…¥æ¬„ä½ */
    const applySpec = (row) => {
        updateItem(item.id, {
            name: row.å“å || "",
            specMain: row.è¦æ ¼ || "",
            unit: row.å–®ä½ || "",
            price: Number(row.å–®åƒ¹ || 0),
            // ç”¨æ–™è‡ªå‹•åˆä½µ
            specMaterial:
                [row.ç”¨æ–™1, row.ç”¨æ–™2, row.ç”¨æ–™3]
                    .filter(x => x && x.trim() !== "")
                    .join(" / ")
        });

        setKeyword("");
        setShowDropdown(false);
    };


    /** â• æ–°å¢å­é …ç›®ï¼ˆæ–‡å­—ï¼‰ */
    const addSubText = () => {
        const sub = {
            id: uuid(),
            type: "text",
            text: ""
        };
        updateItem(item.id, {
            subItems: [...item.subItems, sub]
        });
    };

    /** â• æ–°å¢å­é …ç›®ï¼ˆåœ–ç‰‡ï¼‰ */
    const addSubImage = (file) => {
        const reader = new FileReader();
        reader.onload = (e) => {
            const sub = {
                id: uuid(),
                type: "image",
                url: e.target.result
            };
            updateItem(item.id, {
                subItems: [...item.subItems, sub]
            });
        };
        reader.readAsDataURL(file);
    };

    /** æ›´æ–°å­é …ç›®å…§å®¹ */
    const updateSub = (subId, data) => {
        updateItem(item.id, {
            subItems: item.subItems.map(s =>
                s.id === subId ? { ...s, ...data } : s)
        });
    };

    /** åˆªé™¤å­é …ç›® */
    const deleteSub = (subId) => {
        updateItem(item.id, {
            subItems: item.subItems.filter(s => s.id !== subId)
        });
    };


    return (
        <div className="border rounded p-4 bg-gray-50 shadow-inner">

            {/* æ¨™é¡Œèˆ‡åˆªé™¤ */}
            <div className="flex justify-between mb-2">
                <div className="font-bold text-lg">é …ç›® #{index + 1}</div>

                <button
                    className="text-red-600 hover:underline"
                    onClick={() => deleteItem(item.id)}
                >
                    åˆªé™¤
                </button>
            </div>

            {/* === å“å + Google Sheet è‡ªå‹•æœå°‹ === */}
            <div className="relative mb-3">
                <label className="font-semibold block mb-1">å“åï¼ˆé—œéµå­—æœå°‹ï¼‰ï¼š</label>
                <input
                    type="text"
                    className="w-full border p-2 rounded"
                    value={keyword || item.name}
                    onChange={(e) => {
                        setKeyword(e.target.value);
                        setShowDropdown(true);
                        updateItem(item.id, { name: e.target.value });
                    }}
                    onFocus={() => setShowDropdown(true)}
                />

                {/* ä¸‹æ‹‰é¸å–® */}
                {showDropdown && filteredSpec.length > 0 && (
                    <div className="absolute z-10 bg-white border rounded shadow max-h-60 overflow-y-auto w-full">
                        {filteredSpec.map((row, i) => (
                            <div
                                key={i}
                                className="p-2 hover:bg-blue-100 cursor-pointer text-sm"
                                onClick={() => applySpec(row)}
                            >
                                <div className="font-bold">{row.å“å}</div>
                                <div className="text-gray-600">{row.è¦æ ¼}</div>
                            </div>
                        ))}
                    </div>
                )}
            </div>

            {/* è¦æ ¼ */}
            <label className="font-semibold">è¦æ ¼ï¼š</label>
            <input
                className="w-full border p-2 rounded mb-2"
                value={item.specMain}
                onChange={(e) => updateItem(item.id, { specMain: e.target.value })}
            />

            {/* ç”¨æ–™æ˜ç´°ï¼ˆè‡ªå‹•åˆä½µï¼Œä½†å¯ç·¨è¼¯ï¼‰ */}
            <label className="font-semibold">ç”¨æ–™æ˜ç´°ï¼š</label>
            <input
                className="w-full border p-2 rounded mb-2"
                value={item.specMaterial}
                onChange={(e) => updateItem(item.id, { specMaterial: e.target.value })}
            />

            {/* æ•¸é‡ å–®ä½ å–®åƒ¹ */}
            <div className="grid grid-cols-3 gap-4 mb-2">
                <div>
                    <label className="font-semibold">æ•¸é‡ï¼š</label>
                    <input
                        type="number"
                        className="w-full border p-2 rounded"
                        value={item.qty}
                        onChange={(e) => updateItem(item.id, { qty: Number(e.target.value) })}
                    />
                </div>

                <div>
                    <label className="font-semibold">å–®ä½ï¼š</label>
                    <input
                        className="w-full border p-2 rounded"
                        value={item.unit}
                        onChange={(e) => updateItem(item.id, { unit: e.target.value })}
                    />
                </div>

                <div>
                    <label className="font-semibold">å–®åƒ¹ï¼š</label>
                    <input
                        type="number"
                        className="w-full border p-2 rounded"
                        value={item.price}
                        onChange={(e) => updateItem(item.id, { price: Number(e.target.value) })}
                    />
                </div>
            </div>

            {/* å‚™è¨» */}
            <label className="font-semibold">å‚™è¨»ï¼š</label>
            <textarea
                className="w-full border p-2 rounded mb-3"
                rows="2"
                value={item.remarks}
                onChange={(e) => updateItem(item.id, { remarks: e.target.value })}
            />

            {/* ===== å­é …ç›®å€ ===== */}
            <div className="bg-white border rounded p-3 mt-4">

                <div className="flex justify-between items-center mb-2">
                    <div className="font-bold">å­é …ç›®ï¼ˆè£œå……èªªæ˜ / åœ–ç‰‡ï¼‰</div>

                    <div className="flex gap-2">
                        <button
                            className="px-3 py-1 bg-blue-600 text-white rounded"
                            onClick={addSubText}
                        >
                            + æ–‡å­—
                        </button>

                        {/* åœ–ç‰‡ä¸Šå‚³ */}
                        <label className="px-3 py-1 bg-green-600 text-white rounded cursor-pointer">
                            + åœ–ç‰‡
                            <input
                                type="file"
                                accept="image/*"
                                className="hidden"
                                onChange={(e) => {
                                    if (e.target.files[0]) {
                                        addSubImage(e.target.files[0]);
                                    }
                                }}
                            />
                        </label>
                    </div>
                </div>

                {/* å­é …ç›®åˆ—è¡¨ */}
                <div className="space-y-3">
                    {item.subItems.map(sub => (
                        <div key={sub.id} className="border p-2 rounded bg-gray-50">

                            {/* æ–‡å­—å­é … */}
                            {sub.type === "text" && (
                                <textarea
                                    className="w-full border p-2 rounded"
                                    value={sub.text}
                                    onChange={(e) =>
                                        updateSub(sub.id, { text: e.target.value })
                                    }
                                />
                            )}

                            {/* åœ–ç‰‡å­é … */}
                            {sub.type === "image" && (
                                <img
                                    src={sub.url}
                                    className="max-w-xs border rounded"
                                />
                            )}

                            <button
                                className="mt-1 text-red-600 text-sm hover:underline"
                                onClick={() => deleteSub(sub.id)}
                            >
                                åˆªé™¤
                            </button>
                        </div>
                    ))}
                </div>

            </div>
        </div>
    );
}
/***************************************************
 * A6 â€” PrintLayoutï¼ˆå ±åƒ¹å–®åˆ—å°ç‰ˆï¼‰
 ***************************************************/
function PrintLayout({ quote }) {
    if (!quote) return null;

    const total = calcTotal(quote.items);
    const negotiated = calcNegotiated(
        total,
        quote.discountPercent,
        quote.negotiatedPrice
    );

    const companyInfo = COMPANY_DATA[quote.company] || COMPANY_DATA["herhsin"];

    return (
        <div className="print-page">

            {/* ====== æ¨™é¡Œå€ ====== */}
            <div className="print-header" style={{ textAlign: "center", marginBottom: "15px" }}>
                <h1>{companyInfo.name}</h1>
                <div style={{ fontSize: "14px" }}>
                    é›»è©±ï¼š{companyInfo.tel}ã€€ã€€å‚³çœŸï¼š{companyInfo.fax}
                    <br />
                    åœ°å€ï¼š{companyInfo.address}
                </div>
            </div>

            {/* ====== å ±åƒ¹è³‡è¨Š ====== */}
            <table className="print-info-table" style={{ width: "100%", marginBottom: "10px" }}>
                <tbody>
                    <tr>
                        <td className="print-info-label">å®¢æˆ¶åç¨±</td>
                        <td>{quote.customerName}</td>

                        <td className="print-info-label">å ±åƒ¹æ—¥æœŸ</td>
                        <td>{quote.date}</td>
                    </tr>

                    <tr>
                        <td className="print-info-label">è¯çµ¡äºº</td>
                        <td>{quote.contact}</td>

                        <td className="print-info-label">é›»è©±</td>
                        <td>{quote.phone}</td>
                    </tr>

                    <tr>
                        <td className="print-info-label">å·¥ç¨‹åœ°é»</td>
                        <td colSpan="3">{quote.location}</td>
                    </tr>

                    <tr>
                        <td className="print-info-label">å ±åƒ¹å–®è™Ÿ</td>
                        <td colSpan="3">{quote.quoteNo}</td>
                    </tr>
                </tbody>
            </table>

            {/* ====== é …ç›®è¡¨æ ¼ ====== */}
            <table
                className="print-items-table"
                style={{ width: "100%", borderCollapse: "collapse", marginTop: "10px" }}
            >
                <thead>
                    <tr>
                        <th style={{ border: "1px solid black" }}>é …æ¬¡</th>
                        <th style={{ border: "1px solid black" }}>å“å</th>
                        <th style={{ border: "1px solid black" }}>è¦æ ¼</th>
                        <th style={{ border: "1px solid black" }}>ç”¨æ–™æ˜ç´°</th>
                        <th style={{ border: "1px solid black" }}>æ•¸é‡</th>
                        <th style={{ border: "1px solid black" }}>å–®ä½</th>
                        <th style={{ border: "1px solid black" }}>å–®åƒ¹</th>
                        <th style={{ border: "1px solid black" }}>é‡‘é¡</th>
                    </tr>
                </thead>

                <tbody>
                    {quote.items.map((item, idx) => {

                        const amount = calcAmount(item);

                        return (
                            <React.Fragment key={item.id}>
                                {/* ===== ä¸»é … ===== */}
                                <tr>
                                    <td style={{ border: "1px solid black", textAlign: "center" }}>
                                        {idx + 1}
                                    </td>

                                    <td style={{ border: "1px solid black" }}>{item.name}</td>

                                    <td style={{ border: "1px solid black" }}>{item.specMain}</td>

                                    <td style={{ border: "1px solid black", whiteSpace: "pre-wrap" }}>
                                        {item.specMaterial}
                                    </td>

                                    <td style={{ border: "1px solid black", textAlign: "center" }}>
                                        {item.qty}
                                    </td>

                                    <td style={{ border: "1px solid black", textAlign: "center" }}>
                                        {item.unit}
                                    </td>

                                    <td style={{ border: "1px solid black", textAlign: "right" }}>
                                        {formatMoney(item.price)}
                                    </td>

                                    <td style={{ border: "1px solid black", textAlign: "right" }}>
                                        {formatMoney(amount)}
                                    </td>
                                </tr>

                                {/* ===== ä¸»é …å‚™è¨» ===== */}
                                {item.remarks && (
                                    <tr className="sub-item-note">
                                        <td colSpan="8"
                                            style={{
                                                border: "1px solid gray",
                                                padding: "4px",
                                                background: "#fafafa"
                                            }}>
                                            <strong>å‚™è¨»ï¼š</strong> {item.remarks}
                                        </td>
                                    </tr>
                                )}

                                {/* ===== å­é …ç›®ï¼ˆæ–‡å­— / åœ–ç‰‡ï¼‰ ===== */}
                                {item.subItems?.map((sub) => {
                                    if (sub.type === "text") {
                                        return (
                                            <tr key={sub.id + '-text'}>
                                                <td colSpan="8"
                                                    style={{
                                                        border: "1px solid gray",
                                                        padding: "4px",
                                                        whiteSpace: "pre-wrap"
                                                    }}>
                                                    <strong>èªªæ˜ï¼š</strong>
                                                    <div>{sub.text}</div>
                                                </td>
                                            </tr>
                                        );
                                    }

                                    if (sub.type === "image") {
                                        return (
                                            <tr key={sub.id + '-img'}>
                                                <td colSpan="8"
                                                    style={{
                                                        border: "1px solid gray",
                                                        textAlign: "center",
                                                        padding: "4px"
                                                    }}>
                                                    <strong>è£œå……åœ–ç‰‡ï¼š</strong>
                                                    <br />
                                                    <img
                                                        src={sub.url}
                                                        className="print-image"
                                                        style={{
                                                            maxWidth: "450px",
                                                            marginTop: "6px",
                                                            border: "1px solid #ddd"
                                                        }}
                                                    />
                                                </td>
                                            </tr>
                                        );
                                    }

                                    return null;
                                })}
                            </React.Fragment>
                        );
                    })}
                </tbody>
            </table>

            {/* ====== ç¸½è¨ˆ ====== */}
            <div className="print-total-box" style={{ marginTop: "15px" }}>
                <div>åŸå§‹ç¸½åƒ¹ï¼š <strong>{formatMoney(total)}</strong> å…ƒ</div>

                {quote.discountPercent > 0 && (
                    <div>æŠ˜æ‰£ï¼š {quote.discountPercent}%</div>
                )}

                {quote.negotiatedPrice > 0 && (
                    <div>è­°åƒ¹å¾Œé‡‘é¡ï¼š {formatMoney(negotiated)} å…ƒ</div>
                )}
            </div>

            {/* ====== å‚™è¨» ====== */}
            <div className="print-notes-box">
                <strong>å‚™è¨»ï¼š</strong>
                <div style={{ whiteSpace: "pre-wrap" }}>{quote.notes}</div>
            </div>

            {/* ====== ä»˜æ¬¾æ¢ä»¶ ====== */}
            <div className="print-notes-box" style={{ marginTop: "10px" }}>
                <strong>ä»˜æ¬¾æ¢ä»¶ï¼š</strong>
                <div style={{ whiteSpace: "pre-wrap" }}>{quote.payment}</div>
            </div>

            {/* ====== å°ç«  ====== */}
            <div style={{ marginTop: "20px", textAlign: "right" }}>
                <img
                    src={companyInfo.stamp}
                    style={{ width: "180px", opacity: 0.9 }}
                />
            </div>
        </div>
    );
}
/***************************************************
 * A7 â€” PrintButton : åˆ—å°æŒ‰éˆ•
 * åŠŸèƒ½ï¼šå°‡ PrintLayout éœæ…‹æ¸²æŸ“åˆ° #quotePreviewArea å†åˆ—å°
 ***************************************************/
function PrintButton({ quote }) {
    const handlePrint = () => {
        if (!quote) {
            alert("è«‹å…ˆå»ºç«‹æˆ–é¸æ“‡å ±åƒ¹å–®");
            return;
        }

        // 1ï¸âƒ£ æ‰¾åˆ°åˆ—å°å®¹å™¨
        const preview = document.getElementById("quotePreviewArea");
        if (!preview) {
            alert("æ‰¾ä¸åˆ°åˆ—å°å€åŸŸ");
            return;
        }

        // 2ï¸âƒ£ ç”¨ ReactDOMServer è½‰æˆ HTML å­—ä¸²ï¼ˆä¸ç ´å£ Reactï¼‰
        const html = ReactDOMServer.renderToStaticMarkup(
            <PrintLayout quote={quote} />
        );

        // 3ï¸âƒ£ å¡åˆ°åˆ—å°å°ˆç”¨å€åŸŸ
        preview.innerHTML = html;

        // 4ï¸âƒ£ ç­‰å¾…ç€è¦½å™¨å®Œæˆæ’å…¥å¾ŒåŸ·è¡Œåˆ—å°
        setTimeout(() => {
            window.print();
        }, 150);
    };

    return (
        <button
            onClick={handlePrint}
            className="px-3 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 mt-4 no-print"
        >
            åˆ—å°å ±åƒ¹å–®
        </button>
    );
}
/***************************************************
 * A8 â€” QuoteEditorï¼ˆåŠ å…¥åŒ¯å‡º Excel ï¼‹ åˆ—å°ï¼‰
 ***************************************************/
function QuoteEditor() {
    const { activeQuote, updateQuote } = React.useContext(AppContext);

    if (!activeQuote) {
        return (
            <div className="p-8 text-center text-gray-500 text-xl">
                è«‹å¾å·¦å´é¸æ“‡ä¸€å€‹å ±åƒ¹å–®æˆ–æ–°å»ºä¸€å€‹å ±åƒ¹å–®ã€‚
            </div>
        );
    }

    // æ›´æ–°å ±åƒ¹å–®åŸºç¤æ¬„ä½
    const handleChange = (field, value) => {
        updateQuote(activeQuote.id, { [field]: value });
    };

    // æ›´æ–°é …ç›®
    const updateItem = (id, data) => {
        const newItems = activeQuote.items.map(it =>
            it.id === id ? { ...it, ...data } : it
        );
        updateQuote(activeQuote.id, { items: newItems });
    };

    // åˆªé™¤å¤§é …
    const deleteItem = (id) => {
        const items = activeQuote.items.filter(it => it.id !== id);
        updateQuote(activeQuote.id, { items });
    };

    // æ–°å¢å¤§é …
    const addItem = () => {
        updateQuote(activeQuote.id, {
            items: [
                ...activeQuote.items,
                {
                    id: uuid(),
                    name: "",
                    specMain: "",
                    specMaterial: "",
                    unit: "",
                    qty: 1,
                    price: 0,
                    remarks: "",
                    subItems: []
                }
            ]
        });
    };

    const totalAmount = calcTotal(activeQuote.items);

    return (
        <div className="p-6 bg-gray-100 rounded-lg shadow-xl">

            <h1 className="text-2xl font-bold mb-4 border-b pb-2">
                ç·¨è¼¯å ±åƒ¹å–®ï¼š{activeQuote.title || "æœªå‘½åå ±åƒ¹å–®"}
            </h1>

            {/*************** åŸºæœ¬è³‡æ–™å€ ***************/}
            <div className="bg-white p-4 rounded shadow-inner grid grid-cols-2 gap-4 mb-6">

                {/* å ±åƒ¹å–®ç·¨è™Ÿ */}
                <div className="col-span-2">
                    <label className="font-semibold">å ±åƒ¹å–®ç·¨è™Ÿï¼š</label>
                    <div className="text-blue-700 font-bold text-lg">
                        {activeQuote.quoteNo}
                    </div>
                </div>

                {/* æ¨™é¡Œ */}
                <div className="col-span-2">
                    <label className="font-semibold">å·¥ç¨‹åç¨± / æ¨™é¡Œï¼š</label>
                    <input
                        type="text"
                        value={activeQuote.title}
                        onChange={(e) => handleChange("title", e.target.value)}
                        className="w-full border p-2 rounded"
                    />
                </div>

                {/* å®¢æˆ¶è³‡è¨Š */}
                <div>
                    <label className="font-semibold">å®¢æˆ¶åç¨±ï¼š</label>
                    <input
                        value={activeQuote.customerName}
                        onChange={(e) => handleChange("customerName", e.target.value)}
                        className="w-full border p-2 rounded"
                    />
                </div>

                <div>
                    <label className="font-semibold">è¯çµ¡äººï¼š</label>
                    <input
                        value={activeQuote.contact}
                        onChange={(e) => handleChange("contact", e.target.value)}
                        className="w-full border p-2 rounded"
                    />
                </div>

                <div>
                    <label className="font-semibold">é›»è©±ï¼š</label>
                    <input
                        value={activeQuote.phone}
                        onChange={(e) => handleChange("phone", e.target.value)}
                        className="w-full border p-2 rounded"
                    />
                </div>

                <div>
                    <label className="font-semibold">å ±åƒ¹æ—¥æœŸï¼š</label>
                    <input
                        type="date"
                        value={activeQuote.date}
                        onChange={(e) => handleChange("date", e.target.value)}
                        className="w-full border p-2 rounded"
                    />
                </div>

                <div className="col-span-2">
                    <label className="font-semibold">å·¥ç¨‹åœ°é»ï¼š</label>
                    <input
                        value={activeQuote.location}
                        onChange={(e) => handleChange("location", e.target.value)}
                        className="w-full border p-2 rounded"
                    />
                </div>

                {/* åˆè¨ˆé‡‘é¡ */}
                <div className="col-span-2 mt-2 p-3 bg-blue-50 rounded border-l-4 border-blue-500">
                    <div className="text-xl font-bold text-blue-800">
                        ç¸½é‡‘é¡ï¼ˆæœªç¨…ï¼‰ï¼šNT$ {formatMoney(totalAmount)}
                    </div>
                </div>
            </div>

            {/*************** å ±åƒ¹é …ç›®å€ ***************/}
            <h2 className="text-xl font-bold mb-3">å ±åƒ¹é …ç›®åˆ—è¡¨</h2>

            <button
                className="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 mb-4"
                onClick={addItem}
            >
                ï¼‹ æ–°å¢å·¥ç¨‹å¤§é …
            </button>

            <div className="space-y-6">
                {activeQuote.items.map((it, idx) => (
                    <QuoteItem
                        key={it.id}
                        item={it}
                        index={idx + 1}
                        updateItem={updateItem}
                        deleteItem={deleteItem}
                    />
                ))}
            </div>

            {/*************** å‚™è¨»èˆ‡ä»˜æ¬¾ ***************/}
            <div className="grid grid-cols-2 gap-6 mt-8">
                <div>
                    <h3 className="font-bold">å‚™è¨»ï¼ˆä¸å«ç¨…ï¼‰</h3>
                    <textarea
                        className="w-full h-40 border rounded p-2"
                        value={activeQuote.notes}
                        onChange={(e) => handleChange("notes", e.target.value)}
                    />
                </div>
                <div>
                    <h3 className="font-bold">ä»˜æ¬¾æ¢ä»¶</h3>
                    <textarea
                        className="w-full h-40 border rounded p-2"
                        value={activeQuote.payment}
                        onChange={(e) => handleChange("payment", e.target.value)}
                    />
                </div>
            </div>

            {/*************** åŒ¯å‡ºï¼åˆ—å° ***************/}
            <div className="mt-10 flex gap-4 border-t pt-6">

                {/* åŒ¯å‡º Excel */}
                <ExportButton />

                {/* åˆ—å°å ±åƒ¹å–®ï¼ˆä½¿ç”¨ ReactDOMServerï¼‰ */}
                <PrintButton quote={activeQuote} />
            </div>

        </div>
    );
}
/***************************************************
 * A9 â€” ä¸» Appï¼ˆå·¦å´é¸å–® + å³å´ç·¨è¼¯å™¨ï¼‰
 ***************************************************/
function App() {
    return (
        <AppProvider>
            <div className="flex h-screen">

                {/* å·¦å´å€åŸŸï¼šå…¬å¸åˆ‡æ› / æ¨¡å¼é¸æ“‡ / å ±åƒ¹å–®åˆ—è¡¨ */}
                <div className="w-72 bg-gray-200 p-4 overflow-y-auto no-print border-r">
                    <CompanySelector />
                    <ModeSelector />
                    <QuoteList />
                </div>

                {/* å³å´ä¸»ç·¨è¼¯å™¨ */}
                <div className="flex-1 overflow-y-auto p-6">
                    <QuoteEditor />
                </div>

            </div>
        </AppProvider>
    );
}

/***************************************************
 * A10 â€” æ¸²æŸ“åˆ° #root
 ***************************************************/
ReactDOM.createRoot(document.getElementById("root")).render(<App />);

</script>

</body>
</html>
