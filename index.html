<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>å·¥ç¨‹å ±åƒ¹ç³»çµ±ï¼ˆHerhsin & SinChangï¼‰- æœ€çµ‚æ•´åˆç‰ˆ</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React 18 -->
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- ReactDOMServerï¼ˆåˆ—å° / PDF ç”¨ï¼‰ -->
    <script src="https://unpkg.com/react-dom@18/umd/react-dom-server.browser.production.min.js"></script>

    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- XLSXï¼ˆå¦‚éœ€è¼¸å‡º Excelï¼‰ -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

    <!-- FileSaverï¼ˆPDF æˆªåœ–ç”¨ï¼‰-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>

    <!-- html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
    body {
        font-family: "Microsoft JhengHei", sans-serif;
        background: #f4f4f4;
    }
</style>
</head>

<body>
<div id="root"></div>

<script type="text/babel">

/***************************************************
 * D1 â€” å…±ç”¨å·¥å…·å‡½å¼
 ***************************************************/
function uuid() {
    return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, c => {
        const r = (Math.random() * 16) | 0;
        const v = c === "x" ? r : (r & 0x3) | 0x8;
        return v.toString(16);
    });
}

function formatMoney(num) {
    if (!num || isNaN(num)) return "0";
    return Number(num).toLocaleString("zh-TW", { maximumFractionDigits: 0 });
}

function calcAmount(item) {
    return Number(item.qty || 0) * Number(item.price || 0);
}

function calcTotal(items) {
    let sum = 0;
    items.forEach(i => {
        sum += calcAmount(i);
        if (i.subItems) {
            i.subItems.forEach(s => {
                if (s.type === "item") sum += calcAmount(s);
            });
        }
    });
    return sum;
}

function calcNegotiated(total, percent, customPrice) {
    if (Number(customPrice) > 0) return Number(customPrice);
    if (percent > 0) return Math.round(total * (1 - percent / 100));
    return total;
}

/***************************************************
 * D2 â€” AppContextï¼ˆå…¬å¸è³‡æ–™ï¼‹å…¨åŸŸç‹€æ…‹ï¼‰
 ***************************************************/
const AppContext = React.createContext();

/* ä½ çš„å…¬å¸è³‡æ–™ï¼ˆå®Œå…¨ä¿ç•™ï¼‰*/
const COMPANY_DATA = {
    herhsin: {
        name: "ä½•é‘«å¯¦æ¥­è‚¡ä»½æœ‰é™å…¬å¸",
        tel: "07-6521927",
        fax: "07-6517994",
        email: "affairs@herhsin.com",
        address: "831é«˜é›„å¸‚å¤§å¯®å€é³³å±äºŒè·¯383-8è™Ÿ",
        stamp: "https://amy262631-ui.github.io/Quotation/herhsin_stamp.JPG",
        prefix: "QH"
    },
    sinchang: {
        name: "è–ªæ˜Œè‚¡ä»½æœ‰é™å…¬å¸",
        tel: "07-6521927",
        fax: "07-6517994",
        email: "affairs@herhsin.com",
        address: "831é«˜é›„å¸‚å¤§å¯®å€é³³å±äºŒè·¯383-8è™Ÿ",
        stamp: "https://amy262631-ui.github.io/Quotation/sinchang_stamp.JPG",
        prefix: "QS"
    }
};

/* é è¨­å‚™è¨»ï¼ˆä¿ç•™ï¼‰*/
const DEFAULT_NOTES = `1. æœ¬å ±åƒ¹æœªå«åŠ å€¼ç¨…ã€‚
2. å®‰è£æ–½ä½œæ™‚éœ€æ³¨æ„ç¾å ´ä½œæ¥­ç’°å¢ƒã€‚
3. å ±åƒ¹å–®æœ‰æ•ˆæœŸé™ç‚º 15 å¤©ã€‚
4. è‹¥é‡ä¸å¯æŠ—åŠ›å› ç´ é€ æˆå»¶èª¤ï¼Œå·¥æœŸé †å»¶ã€‚
5. æ–™ä»¶é ˆç”±æœ¬å…¬å¸æä¾›èˆ‡å®‰è£ï¼Œå¦å‰‡ä¸åœ¨ä¿å›ºç¯„åœå…§ã€‚
6. ä»˜æ¬¾æ¢ä»¶ä¾é›™æ–¹åˆç´„å…§å®¹ç‚ºæº–ã€‚`;

/* é è¨­ä»˜æ¬¾æ¢ä»¶ */
const DEFAULT_PAYMENT = `è¨‚é‡‘ï¼š40%
è£½ä½œå®Œæˆï¼š30%
å®‰è£å®Œæˆï¼š20%
å®Œå·¥é©—æ”¶ï¼š10%`;

/* å ±åƒ¹å–®ç·¨è™Ÿç”¢ç”Ÿå™¨ */
function generateQuoteNo(companyKey) {
    const prefix = COMPANY_DATA[companyKey]?.prefix || "Q";
    const d = new Date();
    const datePart =
        d.getFullYear().toString() +
        String(d.getMonth() + 1).padStart(2, "0") +
        String(d.getDate()).padStart(2, "0") +
        String(d.getHours()).padStart(2, "0") +
        String(d.getMinutes()).padStart(2, "0");
    const random = Math.floor(1000 + Math.random() * 9000);

    return `${prefix}${datePart}-${random}`;
}

/***************************************************
 * D2 â€” AppProviderï¼ˆå« GoogleSheet è¼‰å…¥ï¼‰
 ***************************************************/
function AppProvider({ children }) {

    const [company, setCompany] = React.useState("herhsin");
    const [quotes, setQuotes] = React.useState([]);
    const [activeQuoteId, setActiveQuoteId] = React.useState(null);

    /* Google Sheet â€” ææ–™è¦æ ¼å“ */
    const [specItems, setSpecItems] = React.useState([]);

    const SPEC_URL =
        "https://docs.google.com/spreadsheets/d/e/2PACX-1vQHQN_nMBB7l72PSD8omOO55UYRlIClUGEDgtzYzTKK-5fvRWIZowcdnMHvkkwJbdz7krhIiRc00sye/pub?gid=0&single=true&output=csv";

    /* è®€å– localStorage */
    React.useEffect(() => {
        const saved = localStorage.getItem("HERHSIN_QUOTES");
        if (saved) {
            try {
                const arr = JSON.parse(saved);
                if (Array.isArray(arr)) {
                    setQuotes(arr);
                    if (arr.length > 0) setActiveQuoteId(arr[0].id);
                }
            } catch (err) {
                console.error("localStorage load error:", err);
            }
        }
    }, []);

    /* è‡ªå‹•å­˜å› localStorage */
    React.useEffect(() => {
        localStorage.setItem("HERHSIN_QUOTES", JSON.stringify(quotes));
    }, [quotes]);

    /* è¼‰å…¥ Google Sheet */
    React.useEffect(() => {
        async function loadSpec() {
            try {
                const res = await fetch(SPEC_URL);
                const text = await res.text();

                const rows = text.split("\n").map(r => r.trim()).filter(r => r.length);
                const header = rows[0].split(",");

                const list = rows.slice(1).map(row => {
                    const cols = row.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g);
                    const obj = {};
                    header.forEach((h, i) => {
                        let val = cols[i] || "";
                        val = val.replace(/^"|"$/g, "");
                        obj[h.trim()] = val.trim();
                    });
                    return obj;
                });

                setSpecItems(list);
                console.log("ğŸ“Œ è¦æ ¼å“å·²è¼‰å…¥ï¼š", list);
            } catch (err) {
                console.error("Google Sheet è¼‰å…¥éŒ¯èª¤ï¼š", err);
            }
        }

        loadSpec();
    }, []);

    /* æ–°å¢å ±åƒ¹å–® */
    const createQuote = () => {
        const newQuote = {
            id: uuid(),
            company,
            quoteNo: generateQuoteNo(company),
            title: "æœªå‘½åå·¥ç¨‹",
            customerName: "",
            contact: "",
            phone: "",
            location: "",
            date: new Date().toISOString().substring(0, 10),
            items: [],
            notes: DEFAULT_NOTES,
            payment: DEFAULT_PAYMENT,
            discountPercent: 0,
            negotiatedPrice: 0
        };

        setQuotes(prev => [newQuote, ...prev]);
        setActiveQuoteId(newQuote.id);
    };

    /* åˆªé™¤å ±åƒ¹å–® */
    const deleteQuote = (id) => {
        const newList = quotes.filter(q => q.id !== id);
        setQuotes(newList);

        if (activeQuoteId === id) {
            setActiveQuoteId(newList.length ? newList[0].id : null);
        }
    };

    /* æ›´æ–°å ±åƒ¹å–® */
    const updateQuote = (id, update) =>
        setQuotes(prev =>
            prev.map(q => (q.id === id ? { ...q, ...update } : q))
        );

    const activeQuote = quotes.find(q => q.id === activeQuoteId) || null;

    return (
        <AppContext.Provider
            value={{
                company,
                setCompany,
                quotes,
                activeQuote,
                activeQuoteId,
                setActiveQuoteId,
                createQuote,
                deleteQuote,
                updateQuote,
                specItems
            }}
        >
            {children}
        </AppContext.Provider>
    );
}
/***************************************************
 * D3 â€” Autocompleteï¼ˆæœå°‹ GooGleSheet ææ–™ï¼‰
 ***************************************************/
function Autocomplete({ value, onChange, onSelect, list }) {
    const [show, setShow] = React.useState(false);

    return (
        <div className="relative">
            <input
                value={value}
                onChange={(e) => {
                    onChange(e.target.value);
                    setShow(true);
                }}
                placeholder="è¼¸å…¥å“åé—œéµå­—â€¦"
                className="border p-3 rounded w-full text-base"
            />

            {show && list.length > 0 && (
                <div className="absolute bg-white border rounded w-full max-h-48 overflow-y-auto z-50 shadow-lg">
                    {list.map((row, idx) => (
                        <div
                            key={idx}
                            className="p-2 hover:bg-blue-100 cursor-pointer text-sm"
                            onClick={() => {
                                onSelect(row);
                                setShow(false);
                            }}
                        >
                            <div className="font-bold">
                                {row["åç¨±"] || row["å“å"]}
                            </div>
                            <div className="text-gray-500 text-xs">
                                {row["è¦æ ¼"]}
                            </div>
                        </div>
                    ))}
                </div>
            )}
        </div>
    );
}

/***************************************************
 * æœå°‹ææ–™ï¼ˆä¾å“åæ¨¡ç³Šæœå°‹ï¼‰
 ***************************************************/
function searchSpecItems(keyword, specItems) {
    if (!keyword) return [];
    const key = keyword.trim();
    return specItems.filter(row =>
        (row["åç¨±"] || row["å“å"] || "").includes(key)
    );
}

/***************************************************
 * D4 â€” QuoteItemï¼ˆå–®ä¸€é …ç›®ç·¨è¼¯å€ï¼‰
 *      å·²å¼·åŒ– UIï¼ˆå­—é«”æ”¾å¤§ã€æ¬„ä½åŠ ç²—ã€æ•´é½Šç‰ˆé¢ï¼‰
 ***************************************************/
function QuoteItem({ item, index, updateItem, deleteItem }) {

    const { specItems } = React.useContext(AppContext);
    const [nameInput, setNameInput] = React.useState(item.name || "");
    const [showList, setShowList] = React.useState(false);

    /* éæ¿¾ autocomplete çµæœ */
    const matchList = React.useMemo(() => {
        return searchSpecItems(nameInput, specItems);
    }, [nameInput, specItems]);

    /* é¸å®šè¦æ ¼ â†’ è‡ªå‹•å¸¶å…¥æ¬„ä½ */
    const selectSpec = (row) => {
        updateItem(item.id, {
            name: row["åç¨±"] || row["å“å"] || "",
            specMain: row["è¦æ ¼"] || "",
            unit: row["å–®ä½"] || "",
            price: Number(row["å”®åƒ¹"] || row["å–®åƒ¹"] || 0),
            specMaterial: row["ç”¨æ–™1"] || "",
            specMaterial2: row["ç”¨æ–™2"] || "",
            specMaterial3: row["ç”¨æ–™3"] || "",
        });

        setNameInput(row["åç¨±"] || row["å“å"] || "");
        setShowList(false);
    };

    /* æ–°å¢å­é … */
    const addSubItem = (type) => {
        const newSub = { id: uuid(), type, text: "", url: "" };
        updateItem(item.id, {
            subItems: [...(item.subItems || []), newSub]
        });
    };

    /* æ›´æ–°å­é … */
    const updateSubItem = (subId, value) => {
        const newList = (item.subItems || []).map(s =>
            s.id === subId ? { ...s, ...value } : s
        );
        updateItem(item.id, { subItems: newList });
    };

    /* åˆªé™¤å­é … */
    const deleteSubItem = (subId) => {
        const list = (item.subItems || []).filter(s => s.id !== subId);
        updateItem(item.id, { subItems: list });
    };

    return (
        <div className="p-6 bg-white rounded-lg shadow border mb-6">

            {/* ===== æ¨™é¡Œåˆ— ===== */}
            <div className="flex justify-between items-center mb-4">
                <h3 className="text-xl font-bold text-blue-700">é …ç›® {index}</h3>

                <button
                    className="text-red-600 font-bold text-lg"
                    onClick={() => deleteItem(item.id)}
                >
                    âœ• åˆªé™¤æ­¤é …
                </button>
            </div>

            {/* ===== å“å + Autocomplete ===== */}
            <div className="relative mb-4">
                <label className="font-semibold text-base">å“åï¼š</label>

                <input
                    value={nameInput}
                    onChange={(e) => {
                        setNameInput(e.target.value);
                        updateItem(item.id, { name: e.target.value });
                        setShowList(true);
                    }}
                    className="border w-full p-3 rounded text-base"
                    placeholder="è¼¸å…¥å“åé—œéµå­—â€¦"
                />

                {showList && matchList.length > 0 && (
                    <div className="absolute bg-white border rounded w-full max-h-48 overflow-y-auto shadow-xl z-50">
                        {matchList.map((row, idx) => (
                            <div
                                key={idx}
                                className="p-3 hover:bg-blue-100 cursor-pointer"
                                onClick={() => selectSpec(row)}
                            >
                                <div className="font-semibold text-base">
                                    {row["åç¨±"] || row["å“å"]}
                                </div>
                                <div className="text-gray-500 text-sm">
                                    {row["è¦æ ¼"]}
                                </div>
                            </div>
                        ))}
                    </div>
                )}
            </div>

            {/* ===== è¦æ ¼ ===== */}
            <div className="mb-4">
                <label className="font-semibold text-base">è¦æ ¼ï¼š</label>
                <input
                    className="border p-3 rounded w-full text-base"
                    value={item.specMain}
                    onChange={(e) => updateItem(item.id, { specMain: e.target.value })}
                />
            </div>

            {/* ===== ç”¨æ–™ 1~3 ===== */}
            <div className="grid grid-cols-3 gap-4 mb-4">
                <div>
                    <label className="font-semibold text-base">ç”¨æ–™ 1ï¼š</label>
                    <input
                        className="border p-3 rounded w-full text-base"
                        value={item.specMaterial}
                        onChange={(e) => updateItem(item.id, { specMaterial: e.target.value })}
                    />
                </div>

                <div>
                    <label className="font-semibold text-base">ç”¨æ–™ 2ï¼š</label>
                    <input
                        className="border p-3 rounded w-full text-base"
                        value={item.specMaterial2}
                        onChange={(e) => updateItem(item.id, { specMaterial2: e.target.value })}
                    />
                </div>

                <div>
                    <label className="font-semibold text-base">ç”¨æ–™ 3ï¼š</label>
                    <input
                        className="border p-3 rounded w-full text-base"
                        value={item.specMaterial3}
                        onChange={(e) => updateItem(item.id, { specMaterial3: e.target.value })}
                    />
                </div>
            </div>

            {/* ===== å–®ä½ / æ•¸é‡ / å–®åƒ¹ ===== */}
            <div className="grid grid-cols-3 gap-4 mb-4">
                <div>
                    <label className="font-semibold text-base">å–®ä½ï¼š</label>
                    <input
                        className="border p-3 rounded w-full text-base"
                        value={item.unit}
                        onChange={(e) => updateItem(item.id, { unit: e.target.value })}
                    />
                </div>

                <div>
                    <label className="font-semibold text-base">æ•¸é‡ï¼š</label>
                    <input
                        type="number"
                        className="border p-3 rounded w-full text-base"
                        value={item.qty}
                        onChange={(e) => updateItem(item.id, { qty: Number(e.target.value) })}
                    />
                </div>

                <div>
                    <label className="font-semibold text-base">å–®åƒ¹ï¼š</label>
                    <input
                        type="number"
                        className="border p-3 rounded w-full text-base"
                        value={item.price}
                        onChange={(e) => updateItem(item.id, { price: Number(e.target.value) })}
                    />
                </div>
            </div>

            {/* ===== å‚™è¨»ï¼ˆä¸»é …ç›®ï¼‰ ===== */}
            <div className="mb-4">
                <label className="font-semibold text-base">å‚™è¨»ï¼š</label>
                <textarea
                    className="border p-3 rounded w-full text-base"
                    value={item.remarks}
                    onChange={(e) => updateItem(item.id, { remarks: e.target.value })}
                ></textarea>
            </div>

            {/* ===== å­é …ç›®ï¼ˆnote / imageï¼‰ ===== */}
            <div className="space-y-4 mb-4">
                {(item.subItems || []).map((sub) => (
                    <div key={sub.id} className="p-4 border rounded bg-gray-50">

                        {/* è£œå……æ–‡å­— */}
                        {sub.type === "note" && (
                            <>
                                <label className="font-semibold text-base">è£œå……æ–‡å­—ï¼š</label>
                                <textarea
                                    className="border p-3 rounded w-full text-base"
                                    value={sub.text}
                                    onChange={(e) =>
                                        updateSubItem(sub.id, { text: e.target.value })
                                    }
                                ></textarea>
                            </>
                        )}

                        {/* è£œå……åœ–ç‰‡ */}
                        {sub.type === "image" && (
                            <>
                                <label className="font-semibold text-base">è£œå……åœ–ç‰‡ï¼š</label>
                                <input
                                    type="file"
                                    accept="image/*"
                                    onChange={(e) => {
                                        const file = e.target.files[0];
                                        if (file) {
                                            const url = URL.createObjectURL(file);
                                            updateSubItem(sub.id, { url });
                                        }
                                    }}
                                />
                                {sub.url && (
                                    <img
                                        src={sub.url}
                                        className="mt-3 rounded border"
                                        style={{ maxWidth: "260px" }}
                                    />
                                )}
                            </>
                        )}

                        <button
                            className="text-red-600 mt-3 text-base"
                            onClick={() => deleteSubItem(sub.id)}
                        >
                            åˆªé™¤å­é …
                        </button>
                    </div>
                ))}
            </div>

            {/* ===== æ–°å¢å­é … ===== */}
            <div className="flex gap-4">
                <button
                    className="px-4 py-2 bg-blue-600 text-white rounded text-base"
                    onClick={() => addSubItem("note")}
                >
                    ï¼‹ è£œå……æ–‡å­—
                </button>

                <button
                    className="px-4 py-2 bg-green-600 text-white rounded text-base"
                    onClick={() => addSubItem("image")}
                >
                    ï¼‹ è£œå……åœ–ç‰‡
                </button>
            </div>

            {/* ===== å°è¨ˆ ===== */}
            <div className="text-right font-bold text-xl text-blue-800 mt-4">
                å°è¨ˆï¼šNT$ {formatMoney(item.qty * item.price)}
            </div>
        </div>
    );
}
/***************************************************
 * D7 â€” PrintLayoutï¼ˆåˆ—å° / PDF å°ˆç”¨ï¼‰
 ***************************************************/
function PrintLayout({ quote }) {

    if (!quote) return <div>æ²’æœ‰è³‡æ–™</div>;

    const companyData = COMPANY_DATA[quote.company];

    const td = {
        border: "1px solid #000",
        padding: "6px",
        fontSize: "13px",
        verticalAlign: "top"
    };

    const tdCenter = { ...td, textAlign: "center" };
    const tdRight = { ...td, textAlign: "right" };
    const tdBold = { ...td, fontWeight: "bold" };
    const tdRightBold = { ...tdRight, fontWeight: "bold" };

    const totalAmount = calcTotal(quote.items);
    const negotiatedAmount = calcNegotiated(
        totalAmount,
        quote.discountPercent,
        quote.negotiatedPrice
    );

    return (
        <div style={{ padding: "20px", fontFamily: "Microsoft JhengHei" }}>

            {/* ===== æ¨™é¡Œ ===== */}
            <h2
                style={{
                    fontSize: "24px",
                    fontWeight: "bold",
                    textAlign: "center",
                    marginBottom: "20px"
                }}
            >
                å·¥ç¨‹å ±åƒ¹å–®
            </h2>

            {/* ===== åŸºæœ¬è³‡æ–™ ===== */}
            <table style={{ width: "100%", marginBottom: "15px" }}>
                <tbody>
                    <tr>
                        <td style={{ width: "50%", fontSize: "14px" }}>
                            <div><b>å·¥ç¨‹åç¨±ï¼š</b>{quote.title}</div>
                            <div><b>å®¢æˆ¶åç¨±ï¼š</b>{quote.customerName}</div>
                            <div><b>è¯çµ¡äººï¼š</b>{quote.contact}</div>
                            <div><b>é€£çµ¡é›»è©±ï¼š</b>{quote.phone}</div>
                            <div><b>å®‰è£åœ°é»ï¼š</b>{quote.location}</div>
                        </td>

                        <td style={{ width: "50%", fontSize: "14px" }}>
                            <div><b>å ±åƒ¹å–®è™Ÿï¼š</b>{quote.quoteNo}</div>
                            <div><b>æ—¥æœŸï¼š</b>{quote.date}</div>
                            <div><b>å…¬å¸åç¨±ï¼š</b>{companyData.name}</div>
                            <div><b>å…¬å¸é›»è©±ï¼š</b>{companyData.tel}</div>
                            <div><b>åœ°å€ï¼š</b>{companyData.address}</div>
                        </td>
                    </tr>
                </tbody>
            </table>

            {/* ===== ä¸»è¡¨æ ¼ ===== */}
            <table style={{ width: "100%", borderCollapse: "collapse" }}>
                <thead>
                    <tr>
                        <th style={tdCenter}>é …æ¬¡</th>
                        <th style={tdCenter}>å“å</th>
                        <th style={tdCenter}>è¦æ ¼</th>
                        <th style={tdCenter}>å–®ä½</th>
                        <th style={tdCenter}>æ•¸é‡</th>
                        <th style={tdCenter}>å–®åƒ¹</th>
                        <th style={tdCenter}>å°è¨ˆ</th>
                        <th style={tdCenter}>å‚™è¨»</th>
                    </tr>
                </thead>

                <tbody>

                    {quote.items.map((item, idx) => {
                        const amount = calcAmount(item);
                        return (
                            <>
                                {/* ===== ä¸»é … ===== */}
                                <tr key={item.id}>
                                    <td style={tdCenter}>{idx + 1}</td>
                                    <td style={td}>{item.name}</td>
                                    <td style={td}>{item.specMain}</td>
                                    <td style={tdCenter}>{item.unit}</td>
                                    <td style={tdRight}>{item.qty}</td>
                                    <td style={tdRight}>{formatMoney(item.price)}</td>
                                    <td style={tdRightBold}>{formatMoney(amount)}</td>
                                    <td style={td}>{item.remarks || ""}</td>
                                </tr>

                                {/* ===== ç”¨æ–™ 1~3ï¼ˆä¾æ¬¡ç”¢å‡º 1-1 / 1-2 / 1-3ï¼‰ ===== */}
                                {[
                                    item.specMaterial,
                                    item.specMaterial2,
                                    item.specMaterial3
                                ].map((mat, i) =>
                                    mat ? (
                                        <tr key={i + "material"}>
                                            <td style={tdCenter}>{`${idx + 1}-${i + 1}`}</td>
                                            <td colSpan="7" style={td}>
                                                <b>ç”¨æ–™ï¼š</b> {mat}
                                            </td>
                                        </tr>
                                    ) : null
                                )}

                                {/* ===== è£œå……èªªæ˜ ===== */}
                                {(item.subItems || [])
                                    .filter(s => s.type === "note")
                                    .map((s) => (
                                        <tr key={s.id + "_note"}>
                                            <td colSpan="8" style={{ ...td, background: "#fafafa" }}>
                                                <b>è£œå……èªªæ˜ï¼š</b> {s.text}
                                            </td>
                                        </tr>
                                    ))}

                                {/* ===== è£œå……åœ–ç‰‡ ===== */}
                                {(item.subItems || [])
                                    .filter(s => s.type === "image")
                                    .map((s) => (
                                        <tr key={s.id + "_img"}>
                                            <td colSpan="8" style={{ ...td, textAlign: "center" }}>
                                                <img
                                                    src={s.url}
                                                    style={{
                                                        maxWidth: "320px",
                                                        margin: "10px auto",
                                                        border: "1px solid #ccc"
                                                    }}
                                                />
                                            </td>
                                        </tr>
                                    ))}

                            </>
                        );
                    })}

                    {/* ===== ç¸½è¨ˆ ===== */}
                    <tr>
                        <td colSpan="7" style={tdRightBold}>ç¸½è¨ˆï¼ˆæœªç¨…ï¼‰</td>
                        <td style={tdRightBold}>{formatMoney(totalAmount)}</td>
                    </tr>

                    {/* ===== è­°åƒ¹å¾Œ ===== */}
                    <tr>
                        <td colSpan="7" style={tdRightBold}>è­°åƒ¹å¾Œç¸½åƒ¹ï¼ˆæœªç¨…ï¼‰</td>
                        <td style={tdRightBold}>{formatMoney(negotiatedAmount)}</td>
                    </tr>

                </tbody>
            </table>

            {/* ===== å‚™è¨» + ä»˜æ¬¾æ¢ä»¶ ===== */}
            <table style={{ width: "100%", marginTop: "20px" }}>
                <tbody>
                    <tr>
                        <td style={{ width: "50%", fontSize: "14px", verticalAlign: "top" }}>
                            <b>å‚™è¨»ï¼š</b><br />
                            <pre style={{ whiteSpace: "pre-wrap", fontSize: "13px" }}>
                                {quote.notes}
                            </pre>
                        </td>

                        <td style={{ width: "50%", fontSize: "14px", verticalAlign: "top" }}>
                            <b>ä»˜æ¬¾æ¢ä»¶ï¼š</b><br />
                            <pre style={{ whiteSpace: "pre-wrap", fontSize: "13px" }}>
                                {quote.payment}
                            </pre>
                        </td>
                    </tr>
                </tbody>
            </table>

            {/* ===== å°ç«  + å®¢æˆ¶ç°½å ===== */}
            <table style={{
                width: "100%",
                marginTop: "30px",
                borderCollapse: "collapse"
            }}>
                <tbody>
                    <tr>
                        {/* å…¬å¸å°ç«  */}
                        <td style={{
                            ...td,
                            height: "150px",
                            textAlign: "center"
                        }}>
                            <div style={{ fontWeight: "bold", marginBottom: "6px" }}>
                                æœ¬å…¬å¸è“‹ç« 
                            </div>
                            <img
                                src={companyData.stamp}
                                style={{ width: "130px", marginTop: "10px" }}
                            />
                        </td>

                        {/* å®¢æˆ¶å›ç°½ */}
                        <td style={{ ...td, height: "150px", fontSize: "14px" }}>
                            å®¢æˆ¶ç°½åï¼š__________________________<br /><br />
                            æ—¥æœŸï¼š______________________________
                        </td>
                    </tr>
                </tbody>
            </table>

        </div>
    );
}
/***************************************************
 * D6 â€” åˆ—å° PrintButtonï¼ˆæ–°ç‰ˆï¼šä¸å†ä½¿ç”¨ renderToStringï¼‰
 ***************************************************/
function PrintButton({ quote }) {
    const handlePrint = () => {
        if (!quote) {
            alert("å°šæœªé¸æ“‡å ±åƒ¹å–®");
            return;
        }

        // é–‹æ–°è¦–çª—
        const win = window.open("", "_blank");

        // å®¹å™¨
        const container = win.document.createElement("div");
        win.document.body.appendChild(container);

        // ç›´æ¥å°‡ PrintLayout æ¸²æŸ“åˆ°æ–°è¦–çª—çš„ DOM
        ReactDOM.render(<PrintLayout quote={quote} />, container);

        // ç­‰å¾…æ¸²æŸ“å¾Œåˆ—å°
        setTimeout(() => {
            win.print();
        }, 500);
    };

    return (
        <button
            className="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"
            onClick={handlePrint}
        >
            ğŸ–¨ åˆ—å°å ±åƒ¹å–®
        </button>
    );
}


/***************************************************
 * D6 â€” PDF ç”¢ç”Ÿï¼ˆhtml2canvas + jsPDFï¼‰
 ***************************************************/
function ExportPDFButton({ quote }) {
    const generatePDF = async () => {
        if (!quote) {
            alert("è«‹å…ˆé¸æ“‡å ±åƒ¹å–®");
            return;
        }

        // éš±è—å®¹å™¨
        const hidden = document.createElement("div");
        hidden.style.position = "fixed";
        hidden.style.top = "-9999px";
        hidden.style.left = "-9999px";
        hidden.style.width = "794px"; // A4 å¯¬åº¦
        document.body.appendChild(hidden);

        // æ¸²æŸ“åˆ—å°ç‰ˆ
        ReactDOM.render(<PrintLayout quote={quote} />, hidden);

        await new Promise(res => setTimeout(res, 300));

        const canvas = await html2canvas(hidden, { scale: 2 });
        const img = canvas.toDataURL("image/png");

        const pdf = new jspdf.jsPDF("p", "mm", "a4");
        const pdfWidth = pdf.internal.pageSize.getWidth();
        const pdfHeight = (canvas.height * pdfWidth) / canvas.width;

        pdf.addImage(img, "PNG", 0, 0, pdfWidth, pdfHeight);
        pdf.save(`å ±åƒ¹å–®_${quote.quoteNo}.pdf`);

        document.body.removeChild(hidden);
    };

    return (
        <button
            className="bg-purple-600 text-white px-4 py-2 rounded hover:bg-purple-700"
            onClick={generatePDF}
        >
            ğŸ“„ è½‰ PDF
        </button>
    );
}


/***************************************************
 * D7 â€” å ±åƒ¹å–®å³æ™‚é è¦½å€ï¼ˆA4 ç½®ä¸­ï¼‰
 ***************************************************/
function QuotePreview({ quote }) {
    if (!quote) return null;

    return (
        <div className="mt-10 p-6 bg-white shadow-lg border rounded">

            <h2 className="text-xl font-bold mb-3">ğŸ“„ å ±åƒ¹å–®é è¦½ï¼ˆå³æ™‚ï¼‰</h2>

            {/* A4 é è¦½å®¹å™¨ */}
            <div
                style={{
                    width: "794px",         // A4 px å¯¬åº¦
                    margin: "0 auto",       // ç½®ä¸­
                    padding: "20px",
                    background: "white",
                    boxShadow: "0 0 10px rgba(0,0,0,0.15)",
                    transform: "scale(0.85)",
                    transformOrigin: "top center",
                }}
            >
                <PrintLayout quote={quote} />
            </div>
        </div>
    );
}
/***************************************************
 * D8 â€” ä¸»ç³»çµ± Appï¼ˆæ–°ç‰ˆ UI + å¤§å­—é«” + æ’ç‰ˆå¼·åŒ–ï¼‰
 ***************************************************/
function App() {
    const {
        quotes,
        setQuotes,
        activeQuoteId,
        setActiveQuoteId,
        company,
        setCompany,
        specItems
    } = React.useContext(AppContext);

    const activeQuote = quotes.find(q => q.id === activeQuoteId) || null;

    const updateQuoteField = (id, field, value) => {
        setQuotes(prev =>
            prev.map(q => (q.id === id ? { ...q, [field]: value } : q))
        );
    };

    return (
        <div className="flex min-h-screen bg-gray-100">

            {/* ----------------------------------------------------------
               å·¦å´å´é‚Šæ¬„ â€” UI å¼·åŒ–ç‰ˆ
            ---------------------------------------------------------- */}
            <div className="w-72 bg-white border-r shadow-lg p-5">

                <h1 className="text-2xl font-extrabold mb-5 text-gray-800">
                    å·¥ç¨‹å ±åƒ¹ç³»çµ±
                </h1>

                {/* å…¬å¸åˆ‡æ› */}
                <div className="mb-5">
                    <label className="block font-semibold text-gray-700 mb-1">
                        å ±åƒ¹å…¬å¸
                    </label>
                    <select
                        className="w-full border rounded p-2 text-lg"
                        value={company}
                        onChange={(e) => setCompany(e.target.value)}
                    >
                        <option value="herhsin">ä½•é‘«å¯¦æ¥­</option>
                        <option value="sinchang">è–ªæ˜Œè‚¡ä»½</option>
                    </select>
                </div>

                {/* æ–°å¢å ±åƒ¹å–® */}
                <button
                    className="w-full bg-blue-600 text-white py-3 text-lg rounded-lg shadow
                               hover:bg-blue-700 transition mb-6"
                    onClick={createQuote}
                >
                    â• å»ºç«‹æ–°å ±åƒ¹å–®
                </button>

                {/* å ±åƒ¹å–®åˆ—è¡¨ */}
                <h2 className="text-lg font-semibold mb-2 text-gray-700">
                    ğŸ“ å ±åƒ¹å–®åˆ—è¡¨
                </h2>

                <div className="space-y-2 max-h-[60vh] overflow-y-auto pr-2">
                    {quotes.map(q => (
                        <div
                            key={q.id}
                            className={`p-3 rounded border cursor-pointer text-base ${
                                q.id === activeQuoteId
                                    ? "bg-blue-100 border-blue-500"
                                    : "bg-gray-50 hover:bg-gray-100"
                            }`}
                            onClick={() => setActiveQuoteId(q.id)}
                        >
                            <div className="font-bold">{q.title || "æœªå‘½åå·¥ç¨‹"}</div>
                            <div className="text-sm text-gray-600">
                                {q.quoteNo}ï½œ{q.date}
                            </div>
                        </div>
                    ))}
                </div>

            </div>

            {/* ----------------------------------------------------------
               å³å´ä¸»è¦ç·¨è¼¯å€ â€” UI å…¨æå‡ï¼ˆæ–‡å­—å¤§ã€æ¬„ä½æ›´èˆ’æœï¼‰
            ---------------------------------------------------------- */}
            <div className="flex-1 p-8 overflow-y-auto">

                {activeQuote ? (
                    <div className="max-w-5xl mx-auto">

                        {/* å ±åƒ¹åŸºæœ¬è³‡è¨Š */}
                        <h2 className="text-2xl font-bold text-gray-800 mb-6">
                            ğŸ“ ç·¨è¼¯å ±åƒ¹å–® â€” {activeQuote.quoteNo}
                        </h2>

                        <div className="grid grid-cols-2 gap-6 mb-8">

                            <div>
                                <label className="block font-semibold mb-1">å·¥ç¨‹åç¨±</label>
                                <input
                                    className="w-full border rounded p-3 text-lg"
                                    value={activeQuote.title}
                                    onChange={(e) =>
                                        updateQuoteField(activeQuote.id, "title", e.target.value)
                                    }
                                />
                            </div>

                            <div>
                                <label className="block font-semibold mb-1">
                                    å®¢æˆ¶åç¨±
                                </label>
                                <input
                                    className="w-full border rounded p-3 text-lg"
                                    value={activeQuote.customerName}
                                    onChange={(e) =>
                                        updateQuoteField(activeQuote.id, "customerName", e.target.value)
                                    }
                                />
                            </div>

                            <div>
                                <label className="block font-semibold mb-1">
                                    è¯çµ¡äºº
                                </label>
                                <input
                                    className="w-full border rounded p-3 text-lg"
                                    value={activeQuote.contact}
                                    onChange={(e) =>
                                        updateQuoteField(activeQuote.id, "contact", e.target.value)
                                    }
                                />
                            </div>

                            <div>
                                <label className="block font-semibold mb-1">
                                    é›»è©±
                                </label>
                                <input
                                    className="w-full border rounded p-3 text-lg"
                                    value={activeQuote.phone}
                                    onChange={(e) =>
                                        updateQuoteField(activeQuote.id, "phone", e.target.value)
                                    }
                                />
                            </div>

                            <div>
                                <label className="block font-semibold mb-1">
                                    å·¥ç¨‹åœ°é»
                                </label>
                                <input
                                    className="w-full border rounded p-3 text-lg"
                                    value={activeQuote.location}
                                    onChange={(e) =>
                                        updateQuoteField(activeQuote.id, "location", e.target.value)
                                    }
                                />
                            </div>

                            <div>
                                <label className="block font-semibold mb-1">
                                    å ±åƒ¹æ—¥æœŸ
                                </label>
                                <input
                                    type="date"
                                    className="w-full border rounded p-3 text-lg"
                                    value={activeQuote.date}
                                    onChange={(e) =>
                                        updateQuoteField(activeQuote.id, "date", e.target.value)
                                    }
                                />
                            </div>
                        </div>

                        {/* --------------------------------------------------
                            ç”¨æ–™è¦æ ¼å€ D8-2ï¼ˆä¿æŒä½ è¦æ±‚çš„ä¸‹ä¸€æ®µï¼‰
                        -------------------------------------------------- */}
                        <QuoteItemsEditor quote={activeQuote} />

                        {/* åˆ—å° / PDF */}
                        <div className="flex gap-4 mt-10">
                            <PrintButton quote={activeQuote} />
                            <ExportPDFButton quote={activeQuote} />
                        </div>

                        {/* é è¦½å€ */}
                        <QuotePreview quote={activeQuote} />

                    </div>
                ) : (
                    <div className="text-center text-gray-500 text-xl mt-20">
                        è«‹å¾å·¦å´é¸æ“‡æˆ–å»ºç«‹ä¸€å¼µå ±åƒ¹å–®
                    </div>
                )}

            </div>
        </div>
    );
}
/***************************************************
 * D8-2 â€” å ±åƒ¹å–®é …ç›®ç·¨è¼¯ QuoteItemsEditorï¼ˆå¼·åŒ–ç‰ˆï¼‰
 ***************************************************/
function QuoteItemsEditor({ quote }) {
    const { quotes, setQuotes, specItems } = React.useContext(AppContext);

    const updateItem = (index, field, value) => {
        const newItems = [...quote.items];
        newItems[index][field] = value;
        saveItems(newItems);
    };

    const saveItems = (newItems) => {
        setQuotes(prev =>
            prev.map(q =>
                q.id === quote.id ? { ...q, items: newItems } : q
            )
        );
    };

    const addItem = () => {
        const newItem = {
            id: uuid(),
            name: "",
            spec: "",
            unit: "",
            qty: "",
            price: "",
            material1: "",
            material2: "",
            material3: "",
            note: "",
            photo: ""
        };
        saveItems([...quote.items, newItem]);
    };

    const deleteItem = (index) => {
        const newItems = [...quote.items];
        newItems.splice(index, 1);
        saveItems(newItems);
    };

    const handlePhotoUpload = (index, file) => {
        const reader = new FileReader();
        reader.onload = () => {
            updateItem(index, "photo", reader.result);
        };
        reader.readAsDataURL(file);
    };

    return (
        <div className="mb-16">

            {/* æ¨™é¡Œåˆ— */}
            <div className="flex justify-between items-center mb-4">
                <h3 className="text-xl font-bold text-gray-800">ğŸ“¦ å ±åƒ¹å…§å®¹</h3>
                <button
                    onClick={addItem}
                    className="px-4 py-2 bg-green-600 text-white rounded-lg text-lg hover:bg-green-700"
                >
                    â• æ–°å¢é …ç›®
                </button>
            </div>

            {/* å–®é …ç›® */}
            <div className="space-y-10">
                {quote.items.map((item, index) => (
                    <div key={item.id} className="p-5 bg-white shadow border rounded-lg">

                        {/* --------------------------------------------------
                           ç¬¬ä¸€è¡Œï¼šå“åã€è¦æ ¼ï¼ˆå«è‡ªå‹•å¸¶å…¥ï¼‰ã€å–®ä½ã€æ•¸é‡ã€å–®åƒ¹
                        -------------------------------------------------- */}
                        <div className="grid grid-cols-5 gap-4 mb-4 items-end">

                            <div>
                                <label className="font-semibold">å“å</label>
                                <input
                                    className="w-full border rounded p-2 text-lg"
                                    value={item.name}
                                    onChange={(e) =>
                                        updateItem(index, "name", e.target.value)
                                    }
                                />
                            </div>

                            <div>
                                <label className="font-semibold">è¦æ ¼</label>

                                {/* è¦æ ¼ Autocomplete */}
                                <input
                                    list={`specList_${index}`}
                                    className="w-full border rounded p-2 text-lg"
                                    value={item.spec}
                                    onChange={(e) =>
                                        updateItem(index, "spec", e.target.value)
                                    }
                                />
                                <datalist id={`specList_${index}`}>
                                    {specItems.map((spec, i) => (
                                        <option key={i} value={spec["è¦æ ¼"]} />
                                    ))}
                                </datalist>
                            </div>

                            <div>
                                <label className="font-semibold">å–®ä½</label>
                                <input
                                    className="w-full border rounded p-2 text-lg"
                                    value={item.unit}
                                    onChange={(e) =>
                                        updateItem(index, "unit", e.target.value)
                                    }
                                />
                            </div>

                            <div>
                                <label className="font-semibold">æ•¸é‡</label>
                                <input
                                    type="number"
                                    className="w-full border rounded p-2 text-lg"
                                    value={item.qty}
                                    onChange={(e) =>
                                        updateItem(index, "qty", e.target.value)
                                    }
                                />
                            </div>

                            <div>
                                <label className="font-semibold">å–®åƒ¹</label>
                                <input
                                    type="number"
                                    className="w-full border rounded p-2 text-lg"
                                    value={item.price}
                                    onChange={(e) =>
                                        updateItem(index, "price", e.target.value)
                                    }
                                />
                            </div>

                        </div>

                        {/* --------------------------------------------------
                           ç¬¬äºŒè¡Œï¼šç”¨æ–™ 1~3 åˆ†é–‹ç¨ç«‹ä¸€åˆ—
                        -------------------------------------------------- */}
                        <div className="grid grid-cols-3 gap-4 mb-4">
                            <div>
                                <label className="font-semibold">ç”¨æ–™ 1</label>
                                <input
                                    className="w-full border rounded p-2 text-lg"
                                    value={item.material1}
                                    onChange={(e) =>
                                        updateItem(index, "material1", e.target.value)
                                    }
                                />
                            </div>

                            <div>
                                <label className="font-semibold">ç”¨æ–™ 2</label>
                                <input
                                    className="w-full border rounded p-2 text-lg"
                                    value={item.material2}
                                    onChange={(e) =>
                                        updateItem(index, "material2", e.target.value)
                                    }
                                />
                            </div>

                            <div>
                                <label className="font-semibold">ç”¨æ–™ 3</label>
                                <input
                                    className="w-full border rounded p-2 text-lg"
                                    value={item.material3}
                                    onChange={(e) =>
                                        updateItem(index, "material3", e.target.value)
                                    }
                                />
                            </div>
                        </div>

                        {/* --------------------------------------------------
                           å‚™è¨»ï¼šè‹¥æœ‰å¡«å¯« â†’ PrintLayout é¡¯ç¤ºæ–¼ä¸‹ä¸€è¡Œ
                        -------------------------------------------------- */}
                        <div className="mb-4">
                            <label className="font-semibold">å‚™è¨»</label>
                            <textarea
                                className="w-full border rounded p-3 text-lg"
                                rows="2"
                                value={item.note}
                                onChange={(e) =>
                                    updateItem(index, "note", e.target.value)
                                }
                            />
                        </div>

                        {/* --------------------------------------------------
                           åœ–ç‰‡ä¸Šå‚³ï¼ˆç½®ä¸­ï¼‰
                        -------------------------------------------------- */}
                        <div className="text-center mb-4">
                            {item.photo ? (
                                <img
                                    src={item.photo}
                                    className="max-h-60 mx-auto rounded border"
                                />
                            ) : (
                                <div className="text-gray-500 mb-2">
                                    ï¼ˆæœªé¸æ“‡åœ–ç‰‡ï¼‰
                                </div>
                            )}

                            <input
                                type="file"
                                accept="image/*"
                                onChange={(e) =>
                                    handlePhotoUpload(index, e.target.files[0])
                                }
                            />
                        </div>

                        {/* åˆªé™¤æŒ‰éˆ• */}
                        <div className="text-right">
                            <button
                                className="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700"
                                onClick={() => deleteItem(index)}
                            >
                                ğŸ—‘ åˆªé™¤æ­¤é …ç›®
                            </button>
                        </div>
                    </div>
                ))}
            </div>
        </div>
    );
}
/***************************************************
 * D9 â€” AppProviderï¼ˆåŒ…ä½æ•´å€‹ç³»çµ±ï¼‰
 ***************************************************/
function AppProvider({ children }) {
    const [company, setCompany] = React.useState("herhsin");
    const [quotes, setQuotes] = React.useState([]);
    const [activeQuoteId, setActiveQuoteId] = React.useState(null);

    /* Google Sheet è¦æ ¼è³‡æ–™ */
    const [specItems, setSpecItems] = React.useState([]);

    const SPEC_URL =
        "https://docs.google.com/spreadsheets/d/e/2PACX-1vQHQN_nMBB7l72PSD8omOO55UYRlIClUGEDgtzYzTKK-5fvRWIZowcdnMHvkkwJbdz7krhIiRc00sye/pub?gid=0&single=true&output=csv";

    /***************************************************
     * è®€å– localStorage å ±åƒ¹å–®è³‡æ–™
     ***************************************************/
    React.useEffect(() => {
        const saved = localStorage.getItem("HERHSIN_QUOTES");
        if (saved) {
            try {
                const arr = JSON.parse(saved);
                if (Array.isArray(arr)) {
                    setQuotes(arr);
                    if (arr.length > 0) setActiveQuoteId(arr[0].id);
                }
            } catch (err) {
                console.error("localStorage load failed:", err);
            }
        }
    }, []);

    /***************************************************
     * è‡ªå‹•å­˜å› localStorage
     ***************************************************/
    React.useEffect(() => {
        localStorage.setItem("HERHSIN_QUOTES", JSON.stringify(quotes));
    }, [quotes]);

    /***************************************************
     * è¼‰å…¥ Google Sheet â†’ è¦æ ¼è³‡æ–™
     ***************************************************/
    React.useEffect(() => {
        async function loadSpec() {
            try {
                const res = await fetch(SPEC_URL);
                const text = await res.text();
                const rows = text.split("\n");
                const header = rows[0].split(",");

                const parsed = rows
                    .slice(1)
                    .map((row) => {
                        const cols = row.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g);
                        if (!cols) return null;
                        const item = {};
                        header.forEach((h, i) => {
                            let v = cols[i] || "";
                            v = v.replace(/^"|"$/g, "");
                            item[h.trim()] = v.trim();
                        });
                        return item;
                    })
                    .filter(Boolean);

                console.log("ğŸ“Œ è¦æ ¼å“å·²è¼‰å…¥ï¼š", parsed.length);
                setSpecItems(parsed);
            } catch (err) {
                console.error("âŒ Google Sheet è¼‰å…¥éŒ¯èª¤ï¼š", err);
            }
        }

        loadSpec();
    }, []);

    /***************************************************
     * å»ºç«‹æ–°å ±åƒ¹å–®
     ***************************************************/
    const createQuote = () => {
        const newQuote = {
            id: uuid(),
            company,
            quoteNo: generateQuoteNo(company),
            title: "æœªå‘½åå·¥ç¨‹",
            customerName: "",
            contact: "",
            phone: "",
            location: "",
            date: new Date().toISOString().substring(0, 10),
            items: [],
            notes: DEFAULT_NOTES,
            payment: DEFAULT_PAYMENT,
            discountPercent: 0,
            negotiatedPrice: 0
        };

        setQuotes((prev) => [newQuote, ...prev]);
        setActiveQuoteId(newQuote.id);
    };

    return (
        <AppContext.Provider
            value={{
                company,
                setCompany,
                quotes,
                setQuotes,
                activeQuoteId,
                setActiveQuoteId,
                createQuote,
                specItems
            }}
        >
            {children}
        </AppContext.Provider>
    );
}


/***************************************************
 * D10 â€” ReactDOM Renderï¼ˆReact 18ï¼‰
 ***************************************************/
const root = ReactDOM.createRoot(document.getElementById("root"));
root.render(
    <AppProvider>
        <App />
    </AppProvider>
);
