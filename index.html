<!DOCTYPE html>
<html lang="zh-TW">
<head>
Â  <meta charset="UTF-8" />
Â  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
Â  <title>å·¥ç¨‹å ±åƒ¹ç³»çµ±ï¼ˆHerhsin & SinChangï¼‰</title>

Â  Â  <script src="https://cdn.tailwindcss.com"></script>

Â  Â  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
Â  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

Â  Â  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

Â  Â  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

Â  Â  <style>
Â  Â  body {
Â  Â  Â  background: #f3f4f6;
Â  Â  Â  font-family: "Microsoft JhengHei", sans-serif;
Â  Â  }
Â  </style>

Â  Â  <style>
Â  Â  @media print {

Â  Â  Â  /* éš±è—éåˆ—å°å…ƒç´  */
Â  Â  Â  .no-print {
Â  Â  Â  Â  display: none !important;
Â  Â  Â  }

Â  Â  Â  /* åˆ—å°å®¹å™¨ï¼šç¢ºä¿å…§å®¹æ­£ç¢ºå‘ˆç¾ */
Â  Â  Â  body, html {
Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  padding: 0;
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  #root {
Â  Â  Â  Â  display: none; /* éš±è—ä¸»ç·¨è¼¯å€ */
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  #printArea {
Â  Â  Â  Â  display: block !important;
Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  padding: 12mm;
Â  Â  Â  Â  font-size: 13px; /* åˆ—å°å­—é«”ç•¥å° */
Â  Â  Â  Â  color: black;
Â  Â  Â  Â  width: 210mm; /* A4 å¯¬åº¦ */
Â  Â  Â  Â  box-sizing: border-box;
Â  Â  Â  }

Â  Â  Â  /* æ¨™é¡Œ */
Â  Â  Â  .print-header h1 {
Â  Â  Â  Â  font-size: 24px;
Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  text-align: center;
Â  Â  Â  }

Â  Â  Â  /* å®¢æˆ¶/å…¬å¸è³‡è¨Šè¡¨æ ¼ */
Â  Â  Â  .print-info-table {
Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  border: 2px solid black;
Â  Â  Â  Â  margin-bottom: 10px;
Â  Â  Â  }
Â  Â  Â  .print-info-table td {
Â  Â  Â  Â  border: 1px solid black;
Â  Â  Â  Â  padding: 4px 8px;
Â  Â  Â  Â  vertical-align: middle;
Â  Â  Â  }
Â  Â  Â  .print-info-label {
Â  Â  Â  Â  width: 15%;
Â  Â  Â  Â  background: #f0f0f0;
Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  text-align: center;
Â  Â  Â  }

Â  Â  Â  /* å ±åƒ¹é …ç›®è¡¨æ ¼ */
Â  Â  Â  table.print-items-table {
Â  Â  Â  Â  border-collapse: collapse;
Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  font-size: 13px;
Â  Â  Â  Â  table-layout: fixed; /* å›ºå®šåˆ—å¯¬ */
Â  Â  Â  }

Â  Â  Â  .print-items-table th, .print-items-table td {
Â  Â  Â  Â  border: 1px solid black;
Â  Â  Â  Â  padding: 4px 6px;
Â  Â  Â  Â  vertical-align: top;
Â  Â  Â  Â  line-height: 1.4;
Â  Â  Â  Â  height: auto; /* ç¢ºä¿å…§å®¹èƒ½æ’é–‹é«˜åº¦ */
Â  Â  Â  }

Â  Â  Â  .print-items-table th {
Â  Â  Â  Â  background-color: #e0e0e0;
Â  Â  Â  Â  text-align: center;
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  .print-items-table td:nth-child(5), /* æ•¸é‡ */
Â  Â  Â  .print-items-table td:nth-child(6), /* å–®åƒ¹ */
Â  Â  Â  .print-items-table td:nth-child(7) { /* é‡‘é¡ */
Â  Â  Â  Â  text-align: right;
Â  Â  Â  }

Â  Â  Â  /* è¡¨æ ¼åˆ†é æ§åˆ¶ */
Â  Â  Â  thead {
Â  Â  Â  Â  display: table-header-group; 
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  tr {
Â  Â  Â  Â  page-break-inside: avoid; /* é˜²æ­¢è¡Œè¢«æˆªæ–· */
Â  Â  Â  }
Â  Â  Â  
Â  Â  Â  /* ç¸½è¨ˆå€å¡Š */
Â  Â  Â  .print-total-box {
Â  Â  Â  Â  border: 1px solid black;
Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  font-size: 14px;
Â  Â  Â  Â  margin-top: 10px;
Â  Â  Â  }

Â  Â  Â  /* åœ–ç‰‡åˆ—å°æ¨£å¼ */
Â  Â  Â  .print-image {
Â  Â  Â  Â  max-width: 150px; /* é™åˆ¶åˆ—å°åœ–ç‰‡å¤§å° */
Â  Â  Â  Â  height: auto;
Â  Â  Â  Â  margin-top: 5px;
Â  Â  Â  Â  display: block;
Â  Â  Â  }

Â  Â  Â  /* å‚™è¨»/ä»˜æ¬¾æ¢ä»¶å€å¡Š */
Â  Â  Â  .print-notes-box {
Â  Â  Â  Â  margin-top: 15px;
Â  Â  Â  Â  border: 1px solid black;
Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  white-space: pre-wrap; /* ä¿æŒæ›è¡Œ */
Â  Â  Â  }
Â  Â  }
Â  </style>
</head>

<body class="text-gray-900">

Â  Â  <div id="root"></div>

Â  Â  <div id="printArea" class="hidden">
Â  Â  Â  <div id="print-page-number"></div>
Â  Â  Â  {/* åˆ—å°å…§å®¹å°‡åœ¨é€™è£¡ç”Ÿæˆ */}
Â  Â  </div>

<script type="text/babel">
// P1 â€” å…¬å¸è³‡æ–™ / ä»˜æ¬¾æ¢ä»¶ / å‚™è¨» / æ¨¡å¼æ¨¡æ¿
const COMPANY_DATA = {
Â  herhsin: {
Â  Â  name: "ä½•é‘«å¯¦æ¥­è‚¡ä»½æœ‰é™å…¬å¸",
Â  Â  tel: "07-6517476",
Â  Â  fax: "07-6517994",
Â  Â  email: "admin@herhsin.com",
Â  Â  address: "831é«˜é›„å¸‚å¤§å¯®å€é³³æ—ä¸‰è·¯383-3è™Ÿ",
Â  Â  stamp: "herhsin_stamp_placeholder.png" // ä½”ä½ç¬¦
Â  },
Â  sinchang: {
Â  Â  name: "è–ªæ˜Œæœ‰é™å…¬å¸",
Â  Â  tel: "07-6521927",
Â  Â  fax: "07-6517994",
Â  Â  email: "affairs@herhsin.com",
Â  Â  address: "831é«˜é›„å¸‚å¤§å¯®å€é³³æ—ä¸‰è·¯383-3è™Ÿ",
Â  Â  stamp: "sinchang_stamp_placeholder.png" // ä½”ä½ç¬¦
Â  }
};

// é è¨­å‚™è¨»
const DEFAULT_NOTES = `1. æœ¬å ±åƒ¹æœªå«åŠ å€¼ç¨…ã€‚
2. å®‰è£æ–½ä½œæ™‚éœ€æ³¨æ„ç¾å ´ä½œæ¥­ç’°å¢ƒã€‚
3. å ±åƒ¹å–®æœ‰æ•ˆæœŸé™ç‚º 15 å¤©ã€‚
4. è‹¥é‡ä¸å¯æŠ—åŠ›å› ç´ é€ æˆå»¶èª¤ï¼Œå·¥æœŸé †å»¶ã€‚
5. æ–™ä»¶é ˆç”±æœ¬å…¬å¸æä¾›èˆ‡å®‰è£ï¼Œå¦å‰‡ä¸åœ¨ä¿å›ºç¯„åœå…§ã€‚
6. ä»˜æ¬¾æ¢ä»¶ä¾é›™æ–¹åˆç´„å…§å®¹ç‚ºæº–ã€‚`;

// é è¨­ä»˜æ¬¾æ¢ä»¶
const DEFAULT_PAYMENT = `è¨‚é‡‘ï¼š40%
è£½ä½œå®Œæˆï¼š30%
å®‰è£å®Œæˆï¼š20%
å®Œå·¥é©—æ”¶ï¼š10%`;

// å ±åƒ¹æ¨¡å¼æ¨¡æ¿
const QUOTE_MODES = [
Â  {
Â  Â  id: "modeA",
Â  Â  name: "æ‹Œåˆæ©Ÿæ¼æ¼¿æ›´æ›",
Â  Â  description: "é©ç”¨æ‹Œåˆæ©Ÿç¶­ä¿®ã€æ¼æ¼¿è™•ç†ç­‰ã€‚",
Â  Â  defaultItems: [],
Â  Â  defaultNotes: DEFAULT_NOTES,
Â  Â  defaultPayment: DEFAULT_PAYMENT
Â  },
Â  {
Â  Â  id: "modeB",
Â  Â  name: "è¨­å‚™éŠ·å”®",
Â  Â  description: "é©ç”¨å‚™å“ã€å–®æ©ŸéŠ·å”®èˆ‡å®‰è£ã€‚",
Â  Â  defaultItems: [],
Â  Â  defaultNotes: DEFAULT_NOTES,
Â  Â  defaultPayment: DEFAULT_PAYMENT
Â  },
Â  {
Â  Â  id: "modeC",
Â  Â  name: "è¨­å‚™æ›´æ›å·¥ç¨‹",
Â  Â  description: "é©ç”¨æ•´æ©Ÿæ›´æ–°ã€æ–™ä»¶æ›´æ›å·¥ç¨‹ã€‚",
Â  Â  defaultItems: [],
Â  Â  defaultNotes: DEFAULT_NOTES,
Â  Â  defaultPayment: DEFAULT_PAYMENT
Â  }
];

// P2 â€” å·¥å…·å‡½å¼ï¼ˆå®Œæ•´ï¼‰
function uuid() {
Â  return "xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g, function (c) {
Â  Â  const r = (Math.random() * 16) | 0;
Â  Â  const v = c === "x" ? r : (r & 0x3) | 0x8;
Â  Â  return v.toString(16);
Â  });
}

function formatDate(dateStr = new Date()) {
Â  const d = dateStr instanceof Date ? dateStr : new Date(dateStr);
Â  const y = d.getFullYear();
Â  const m = String(d.getMonth() + 1).padStart(2, "0");
Â  const day = String(d.getDate()).padStart(2, "0");
Â  return `${y}-${m}-${day}`; // æ”¹ç‚º ISO æ ¼å¼ä»¥åˆ© input type="date"
}

function formatMoney(num) {
Â  // è™•ç†ç©ºå€¼å’Œéæ•¸å­—ï¼Œä½†å…è¨±æ•¸å­— 0
Â  if (num === "" || num === null || num === undefined || isNaN(Number(num))) return "";
Â  return Number(num).toLocaleString("zh-TW", { maximumFractionDigits: 0 });
}

function calcAmount(item) {
Â  // ç¢ºä¿ qty å’Œ price è½‰ç‚ºæ•¸å­—ï¼Œå¦å‰‡ç‚º 0
Â  const qty = Number(item.qty || 0);
Â  const price = Number(item.price || 0);
Â  return qty * price;
}

function calcTotal(items) {
Â  return items.reduce((sum, it) => {
Â  Â  let mainAmt = calcAmount(it);
Â  Â  let subs = 0;

Â  Â  if (it.subItems && it.subItems.length > 0) {
Â  Â  Â  subs = it.subItems.reduce((s, sub) => s + calcAmount(sub), 0);
Â  Â  }

Â  Â  return sum + mainAmt + subs;
Â  }, 0);
}

function calcNegotiated(total, discountPercent, customPrice) {
Â  const cp = Number(customPrice || 0);
Â  const dp = Number(discountPercent || 0);
Â  
Â  if (cp > 0) return cp;
Â  
Â  if (dp > 0 && dp < 100) {
Â  Â  return Math.round(total * (1 - dp / 100));
Â  }
Â  return total;
}

// å ±åƒ¹å–®ç·¨è™Ÿ
function generateQuoteNo() {
Â  // ä½¿ç”¨ YYYYMMDDHHMM + 4ä½äº‚æ•¸
Â  const d = new Date();
Â  const parts = [
Â  Â  d.getFullYear(),
Â  Â  String(d.getMonth() + 1).padStart(2, "0"),
Â  Â  String(d.getDate()).padStart(2, "0"),
Â  Â  String(d.getHours()).padStart(2, "0"),
Â  Â  String(d.getMinutes()).padStart(2, "0"),
Â  ].join('');
Â  
Â  const random = Math.floor(1000 + Math.random() * 9000);
Â  
Â  return `Q${parts}-${random}`;
}

// è¼‰å…¥ Google Sheet CSV (éåŒæ­¥å‡½å¼)
async function loadCSV(url) {
Â  try {
Â  Â  const res = await fetch(url);
Â  Â  const text = await res.text();
Â  Â  // é€™è£¡éœ€è¦ä¸€å€‹æ›´å¼·å¥çš„ CSV è§£æå™¨ï¼Œä½†ç‚ºäº†ä¿æŒå–®ä¸€æª”æ¡ˆæ¶æ§‹ï¼Œæš«æ™‚ç°¡åŒ–
Â  Â  const rows = text.split("\n").map(r => r.trim()).filter(r => r.length > 0);
Â  Â  if (rows.length === 0) return [];
Â  Â  
Â  Â  // å‡è¨­ç¬¬ä¸€è¡Œç‚ºæ¨™é ­ï¼Œä¸”ä¸åŒ…å«é€—è™Ÿ
Â  Â  const header = rows[0].split(",").map(h => h.trim());

Â  Â  return rows.slice(1).map(row => {
Â  Â  Â  // ç°¡æ˜“è§£æï¼Œå¯èƒ½æœƒåœ¨æ¬„ä½ä¸­æœ‰é€—è™Ÿæ™‚å‡ºéŒ¯
Â  Â  Â  const cols = row.split(",");
Â  Â  Â  const obj = {};

Â  Â  Â  header.forEach((h, i) => {
Â  Â  Â  Â  // ä¿®å‰ªæ¨™é ­å’Œå…§å®¹
Â  Â  Â  Â  obj[h] = cols[i] ? cols[i].trim() : "";
Â  Â  Â  });
Â  Â  Â  return obj;
Â  Â  });
Â  } catch (error) {
Â  Â  console.error("è¼‰å…¥æˆ–è§£æ Google Sheet CSV å¤±æ•—:", error);
Â  Â  return [];
Â  }
}


// P3 â€” AppContextï¼ˆæ ¸å¿ƒè³‡æ–™ä¸­å¿ƒï¼‰
const AppContext = React.createContext();

function AppProvider({ children }) {
Â  // å…¬å¸ herhsin / sinchang
Â  const [company, setCompany] = React.useState("herhsin");

Â  // å ±åƒ¹å–®åˆ—è¡¨
Â  const [quotes, setQuotes] = React.useState([]);

Â  // æ­£åœ¨ç·¨è¼¯çš„å ±åƒ¹å–® ID
Â  const [activeQuoteId, setActiveQuoteId] = React.useState(null);

Â  // è¦æ ¼å“ï¼ˆä¾†è‡ª Google Sheetï¼‰
Â  const [specItems, setSpecItems] = React.useState([]);

Â  // Google Sheet è·¯å¾‘ (è«‹å‹™å¿…å°‡æ­¤æ›¿æ›ç‚ºæ‚¨çš„å…¬é–‹ CSV é€£çµ)
Â  const SPEC_CSV_URL =
Â  Â  "https://docs.google.com/spreadsheets/d/e/2PACX-1vQHQN_nMBB7l72PSD8omOO55UYRlIClUGEDgtzYzTKK-5fvRWIZowcdnMHvkkwJbdz7krhIiRc00sye/pub?gid=0&single=true&output=csv"; 
Â  Â  // ^^^^^^ è«‹ç¢ºä¿é€™æ˜¯æ‚¨æœ€æ–°çš„å…¬é–‹ CSV é€£çµ ^^^^^^

Â  //************* åˆå§‹åŒ–ï¼šå¾ localStorage è¼‰å…¥ *************/
Â  React.useEffect(() => {
Â  Â  const saved = localStorage.getItem("HERHSIN_QUOTES");

Â  Â  if (saved) {
Â  Â  Â  try {
Â  Â  Â  Â  const parsed = JSON.parse(saved);
Â  Â  Â  Â  // ç¢ºä¿è¼‰å…¥çš„æ˜¯é™£åˆ—
Â  Â  Â  Â  if (Array.isArray(parsed)) {
Â  Â  Â  Â  Â  setQuotes(parsed);
Â  Â  Â  Â  Â  if (parsed.length > 0) setActiveQuoteId(parsed[0].id);
Â  Â  Â  Â  }
Â  Â  Â  } catch (e) {
Â  Â  Â  Â  console.error("è§£æ localStorage æ•¸æ“šå¤±æ•—:", e);
Â  Â  Â  Â  setQuotes([]);
Â  Â  Â  Â  setActiveQuoteId(null);
Â  Â  Â  }
Â  Â  }
Â  }, []);

Â  //************* è‡ªå‹•å­˜å› localStorage *************/
Â  React.useEffect(() => {
Â  Â  try {
Â  Â  Â  localStorage.setItem("HERHSIN_QUOTES", JSON.stringify(quotes));
Â  Â  } catch (e) {
Â  Â  Â  console.error("å¯«å…¥ localStorage å¤±æ•—:", e);
Â  Â  }
Â  }, [quotes]);


Â  //************* è¼‰å…¥ Google Sheet è¦æ ¼å“ *************/
Â  React.useEffect(() => {
Â  Â  // ç”±æ–¼ CDN ç’°å¢ƒä¸‹ä¸æ‡‰éåº¦ä¾è³´éåŒæ­¥å¤–éƒ¨è³‡æºï¼Œåƒ…åšä¸€æ¬¡è¼‰å…¥å˜—è©¦
Â  Â  loadCSV(SPEC_CSV_URL).then(data => setSpecItems(data));
Â  }, [SPEC_CSV_URL]); // ä¾è³´é …åŠ å…¥ URLï¼Œå¦‚æœ URL æ”¹è®Šæœƒé‡æ–°è¼‰å…¥


Â  // å»ºç«‹æ–°å ±åƒ¹å–®ï¼ˆå¯å¥—ç”¨æ¨¡å¼ï¼‰
Â  const createQuote = React.useCallback((modeId = null) => {
Â  Â  const mode = QUOTE_MODES.find(m => m.id === modeId);

Â  Â  const newQuote = {
Â  Â  Â  id: uuid(),
Â  Â  Â  quoteNo: generateQuoteNo(),
Â  Â  Â  title: mode ? mode.name : "æœªå‘½åå·¥ç¨‹",
Â  Â  Â  customerName: "",
Â  Â  Â  contact: "",
Â  Â  Â  phone: "",
Â  Â  Â  location: "",
Â  Â  Â  date: formatDate(), // ä½¿ç”¨ä¿®æ­£å¾Œçš„æ ¼å¼åŒ–å‡½æ•¸
Â  Â  Â  items: mode && Array.isArray(mode.defaultItems) ? mode.defaultItems.map(item => ({...item, id: uuid(), subItems: []})) : [],
Â  Â  Â  notes: mode ? mode.defaultNotes : DEFAULT_NOTES,
Â  Â  Â  payment: mode ? mode.defaultPayment : DEFAULT_PAYMENT,
Â  Â  Â  discountPercent: 0,
Â  Â  Â  negotiatedPrice: 0
Â  Â  };

Â  Â  setQuotes(prev => {
Â  Â  Â  const newList = [newQuote, ...prev]; // æ–°å ±åƒ¹å–®æ”¾åœ¨æœ€å‰é¢
Â  Â  Â  setActiveQuoteId(newQuote.id);
Â  Â  Â  return newList;
Â  Â  });
Â  }, []);


Â  // åˆªé™¤å ±åƒ¹å–®
Â  const deleteQuote = React.useCallback((id) => {
Â  Â  setQuotes(prev => {
Â  Â  Â  const newList = prev.filter(q => q.id !== id);
Â  Â  Â  
Â  Â  Â  if (id === activeQuoteId) {
Â  Â  Â  Â  setActiveQuoteId(newList.length > 0 ? newList[0].id : null);
Â  Â  Â  }
Â  Â  Â  return newList;
Â  Â  });
Â  }, [activeQuoteId]);


Â  // æ›´æ–°å ±åƒ¹å–®æ¬„ä½
Â  const updateQuote = React.useCallback((id, data) => {
Â  Â  setQuotes(prev =>
Â  Â  Â  prev.map(q => (q.id === id ? { ...q, ...data } : q))
Â  Â  );
Â  }, []);


Â  // å¥—ç”¨æ¨¡å¼ï¼ˆè¦†è“‹ï¼šæ¨™é¡Œã€å‚™è¨»ã€ä»˜æ¬¾ã€é è¨­é …ç›®ï¼‰
Â  const applyMode = React.useCallback((modeId) => {
Â  Â  const mode = QUOTE_MODES.find(m => m.id === modeId);
Â  Â  if (!mode || !activeQuoteId) return;

Â  Â  // ç¢ºä¿ defaultItems ä¸­çš„æ¯å€‹ item éƒ½æœ‰å”¯ä¸€çš„ id
Â  Â  const itemsWithIds = mode.defaultItems.map(item => ({...item, id: uuid(), subItems: []}));

Â  Â  updateQuote(activeQuoteId, {
Â  Â  Â  title: mode.name,
Â  Â  Â  items: itemsWithIds, // ä½¿ç”¨å¸¶æœ‰ ID çš„é …ç›®
Â  Â  Â  notes: mode.defaultNotes,
Â  Â  Â  payment: mode.defaultPayment,
Â  Â  });
Â  }, [activeQuoteId, updateQuote]);


Â  // Context æä¾›çµ¦å…¨ App
Â  const activeQuote = quotes.find(q => q.id === activeQuoteId);
Â  
Â  const value = {
Â  Â  company,
Â  Â  setCompany,

Â  Â  quotes,
Â  Â  createQuote,
Â  Â  deleteQuote,
Â  Â  updateQuote,
Â  Â  activeQuote, // ç›´æ¥æä¾›ç•¶å‰å ±åƒ¹å–®ç‰©ä»¶
Â  Â  activeQuoteId,
Â  Â  setActiveQuoteId,

Â  Â  specItems,
Â  Â  applyMode
Â  };

Â  // è®“åˆ—å°å’Œ Excel åŒ¯å‡ºåŠŸèƒ½å¯ä»¥å…¨åŸŸæŠ“åˆ° Context
Â  window.__APP_CONTEXT__ = value;

Â  return (
Â  Â  <AppContext.Provider value={value}>
Â  Â  Â  {children}
Â  Â  </AppContext.Provider>
Â  );
}
// P4-1 â€” å·¦å´å…ƒä»¶ï¼šå…¬å¸åˆ‡æ› / æ¨¡å¼é¸æ“‡ / å ±åƒ¹å–®åˆ—è¡¨


// --------------------------------------------------
// å…¬å¸åˆ‡æ›ï¼ˆä½•é‘« / è–ªæ˜Œï¼‰
// --------------------------------------------------
function CompanySelector() {
Â  const { company, setCompany } = React.useContext(AppContext);

Â  return (
Â  Â  <div className="mb-6 no-print">
Â  Â  Â  <div className="font-bold mb-2">é¸æ“‡å…¬å¸</div>

Â  Â  Â  <div className="flex gap-2">
Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  className={`px-3 py-1 rounded ${
Â  Â  Â  Â  Â  Â  company === "herhsin"
Â  Â  Â  Â  Â  Â  Â  ? "bg-blue-600 text-white"
Â  Â  Â  Â  Â  Â  Â  : "bg-gray-300 hover:bg-gray-400"
Â  Â  Â  Â  Â  }`}
Â  Â  Â  Â  Â  onClick={() => setCompany("herhsin")}
Â  Â  Â  Â  >
Â  Â  Â  Â  Â  ä½•é‘«å¯¦æ¥­
Â  Â  Â  Â  </button>

Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  className={`px-3 py-1 rounded ${
Â  Â  Â  Â  Â  Â  company === "sinchang"
Â  Â  Â  Â  Â  Â  Â  ? "bg-blue-600 text-white"
Â  Â  Â  Â  Â  Â  Â  : "bg-gray-300 hover:bg-gray-400"
Â  Â  Â  Â  Â  }`}
Â  Â  Â  Â  Â  onClick={() => setCompany("sinchang")}
Â  Â  Â  Â  >
Â  Â  Â  Â  Â  è–ªæ˜Œæœ‰é™å…¬å¸
Â  Â  Â  Â  </button>
Â  Â  Â  </div>
Â  Â  </div>
Â  );
}


// --------------------------------------------------
// å ±åƒ¹æ¨¡å¼é¸æ“‡å™¨ï¼ˆA ç¶­ä¿®ã€B æ¶ä¿®ã€C æ‹Œåˆæ©Ÿæ¼æ¼¿â€¦ï¼‰
// --------------------------------------------------
function ModeSelector() {
Â  const { createQuote } = React.useContext(AppContext);

Â  return (
Â  Â  <div className="mb-6 no-print">
Â  Â  Â  <div className="font-bold mb-2">å»ºç«‹å ±åƒ¹å–®ï¼ˆå¥—ç”¨æ¨¡å¼ï¼‰</div>

Â  Â  Â  <div className="flex flex-col gap-2">

Â  Â  Â  Â  {QUOTE_MODES.map(mode => (
Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  Â  key={mode.id}
Â  Â  Â  Â  Â  Â  className="px-3 py-2 bg-gray-200 hover:bg-gray-300 rounded text-left"
Â  Â  Â  Â  Â  Â  onClick={() => createQuote(mode.id)}
Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  â¤ {mode.name}
Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  ))}

Â  Â  Â  Â  {/* ç„¡æ¨¡å¼ï¼šç©ºç™½å ±åƒ¹å–® */}
Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  className="px-3 py-2 bg-green-600 text-white rounded hover:bg-green-700"
Â  Â  Â  Â  Â  onClick={() => createQuote(null)}
Â  Â  Â  Â  >
Â  Â  Â  Â  Â  ï¼‹ ç©ºç™½å ±åƒ¹å–®
Â  Â  Â  Â  </button>
Â  Â  Â  </div>
Â  Â  </div>
Â  );
}


// --------------------------------------------------
// å ±åƒ¹å–®ç®¡ç†ï¼šåˆ—è¡¨ã€åˆ‡æ›ã€åˆªé™¤ (ä¿®æ­£ç‰ˆ)
// --------------------------------------------------
function QuoteManager() {
Â  const {
Â  Â  quotes,
Â  Â  activeQuoteId,
Â  Â  setActiveQuoteId,
Â  Â  deleteQuote,
Â  Â  createQuote, // ä½¿ç”¨ createQuote æ›¿æ› addQuote
Â  } = React.useContext(AppContext);

Â  // æ ¹æ“š ID æ’åºï¼Œè®“æœ€æ–°çš„æ’åœ¨æœ€ä¸Šé¢
Â  const sortedQuotes = React.useMemo(() => {
Â  Â  // ç¢ºä¿ quotes æ˜¯é™£åˆ—ä¸”åŒ…å«æœ‰æ•ˆçš„ id
Â  Â  return [...(quotes || [])].sort((a, b) => {
Â  Â  Â  if (!a.id || !b.id) return 0;
Â  Â  Â  // é€™è£¡ä½¿ç”¨ ID é€²è¡Œæ¯”è¼ƒ (å‡è¨­ ID åŒ…å«æ™‚é–“ä¿¡æ¯ï¼Œæˆ–è€…æ‚¨éœ€è¦æ ¹æ“šæ—¥æœŸå­—æ®µæ’åº)
Â  Â  Â  return b.id.localeCompare(a.id); 
Â  Â  });
Â  }, [quotes]);


Â  return (
Â  Â  <div className="mt-4 border-t pt-4"> 
Â  Â  Â  <h3 className="font-bold text-lg mb-2 text-gray-700">å ±åƒ¹å–®åˆ—è¡¨</h3>

Â  Â  Â  {/* æ–°å¢å ±åƒ¹å–®æŒ‰éˆ• (å°å‘å»ºç«‹ç©ºç™½å ±åƒ¹å–®) */}
Â  Â  Â  <button
Â  Â  Â  Â  className="w-full px-3 py-2 bg-purple-600 text-white rounded mb-4 hover:bg-purple-700 transition"
Â  Â  Â  Â  onClick={() => createQuote(null)} // å»ºç«‹ç©ºç™½å ±åƒ¹å–®
Â  Â  Â  >
Â  Â  Â  Â  ï¼‹ å»ºç«‹æ–°å ±åƒ¹å–®
Â  Â  Â  </button>

Â  Â  Â  <div className="max-h-80 overflow-y-auto">
Â  Â  Â  {sortedQuotes.length === 0 && ( // ä½¿ç”¨ sortedQuotes
Â  Â  Â  Â  <div className="text-gray-500 text-sm text-center">
Â  Â  Â  Â  Â  å°šç„¡è³‡æ–™ï¼Œè«‹å…ˆå»ºç«‹å ±åƒ¹å–®
Â  Â  Â  Â  </div>
Â  Â  Â  )}

Â  Â  Â  <div className="flex flex-col gap-1">
Â  Â  Â  Â  {sortedQuotes.map(q => ( // ä½¿ç”¨ sortedQuotes
Â  Â  Â  Â  Â  <div
Â  Â  Â  Â  Â  Â  key={q.id}
Â  Â  Â  Â  Â  Â  className={`flex items-center justify-between px-3 py-2 rounded cursor-pointer transition
Â  Â  Â  Â  Â  Â  Â  ${
Â  Â  Â  Â  Â  Â  Â  Â  q.id === activeQuoteId
Â  Â  Â  Â  Â  Â  Â  Â  Â  ? "bg-blue-600 text-white shadow-md"
Â  Â  Â  Â  Â  Â  Â  Â  Â  : "bg-gray-100 hover:bg-gray-200 text-gray-800"
Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  `}
Â  Â  Â  Â  Â  Â  onClick={() => setActiveQuoteId(q.id)}
Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  {/* æ–‡å­—å€å¡Šï¼šåŠ å…¥ min-w-0 å…è¨±å£“ç¸®/æˆªæ–· */}
Â  Â  Â  Â  Â  Â  <div className="flex flex-col flex-1 min-w-0 mr-2"> 
Â  Â  Â  Â  Â  Â  Â  {/* æ¨™é¡Œï¼šç¢ºä¿æˆªæ–· */}
Â  Â  Â  Â  Â  Â  Â  <span className="font-semibold truncate text-sm">{q.title}</span>
Â  Â  Â  Â  Â  Â  Â  {/* è³‡è¨Šï¼šè¼ƒå°çš„å­—é«”ï¼Œå…è¨±æ›è¡Œ */}
Â  Â  Â  Â  Â  Â  Â  <span className="text-xs opacity-80 whitespace-normal">
Â  Â  Â  Â  Â  Â  Â  Â  {q.date} - {q.customerName || "ç„¡å®¢æˆ¶"}
Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  {/* æŒ‰éˆ•å€å¡Šï¼šåŠ å…¥ flex-shrink-0 ç¢ºä¿å¯¬åº¦å›ºå®šï¼Œä¸æ“ å£“æ–‡å­— */}
Â  Â  Â  Â  Â  Â  <button
Â  Â  Â  Â  Â  Â  Â  className={`text-red-600 text-xs ml-2 p-1 font-bold transition flex-shrink-0 
Â  Â  Â  Â  Â  Â  Â  ${q.id === activeQuoteId ? "bg-red-500 hover:bg-red-600 text-white" : "hover:text-red-800"}
Â  Â  Â  Â  Â  Â  Â  `}
Â  Â  Â  Â  Â  Â  Â  onClick={(e) => {
Â  Â  Â  Â  Â  Â  Â  Â  e.stopPropagation(); // é¿å…é»åˆ°çˆ¶å±¤
Â  Â  Â  Â  Â  Â  Â  Â  if (confirm("ç¢ºå®šè¦åˆªé™¤é€™ä»½å ±åƒ¹å–®ï¼Ÿ")) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  deleteQuote(q.id);
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  }}
Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  åˆªé™¤
Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  ))}
Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>
Â  );
}
// P4-2 â€” å ±åƒ¹å–®æŠ¬é ­ï¼šå…¬å¸è³‡è¨Š + å®¢æˆ¶è³‡è¨Šè¼¸å…¥å€
function QuoteEditor() {
Â  const {
Â  Â  company,
Â  Â  activeQuote, // ç›´æ¥å–ç”¨ activeQuote
Â  Â  updateQuote
Â  } = React.useContext(AppContext);

Â  const quote = activeQuote;

Â  // -------------------------------
Â  // æ›´æ–°æ¬„ä½ (Hooks å¿…é ˆæ”¾åœ¨é ‚å±¤)
Â  // -------------------------------
Â  const update = React.useCallback((field, value) => {
Â  Â  // ç¢ºä¿ quote å­˜åœ¨å†å‘¼å« updateQuote
Â  Â  if (quote) {
Â  Â  Â  updateQuote(quote.id, { [field]: value });
Â  Â  }
Â  }, [quote, updateQuote]); // ä¾è³´é …æ”¹ç‚º quote ç‰©ä»¶

Â  // å¦‚æœ quote ä¸å­˜åœ¨ï¼Œææ—©è¿”å› (æ”¾åœ¨æ‰€æœ‰ Hooks ä¹‹å¾Œ)
Â  if (!quote) return null;

Â  // å¼•ç”¨ P1 çš„å…¨å±€æ•¸æ“š
Â  const info = COMPANY_DATA[company];

Â  return (
Â  Â  <div className="bg-white p-6 shadow rounded mb-6 no-print">

Â  Â  Â  {/* ---------------- å…¬å¸åç¨± ---------------- */}
Â  Â  Â  <div className="text-2xl font-bold mb-4 text-blue-800">
Â  Â  Â  Â  {info.name}
Â  Â  Â  </div>

Â  Â  Â  {/* ---------------- å…¬å¸è³‡æ–™ ---------------- */}
Â  Â  Â  <div className="text-sm text-gray-600 mb-6 border-b pb-4">
Â  Â  Â  Â  <div>åœ°å€ï¼š{info.address}</div>
Â  Â  Â  Â  <div>é›»è©±ï¼š{info.tel} | å‚³çœŸï¼š{info.fax}</div>
Â  Â  Â  </div>

Â  Â  Â  {/* ---------------- å ±åƒ¹å–®æ¨™é¡Œ & ç·¨è™Ÿ ---------------- */}
Â  Â  Â  <div className="flex items-end gap-4 mb-6">
Â  Â  Â  Â  <div className="flex-1">
Â  Â  Â  Â  Â  <label className="block text-sm text-gray-600 mb-1">å·¥ç¨‹åç¨±</label>
Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  type="text"
Â  Â  Â  Â  Â  Â  className="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-blue-300 focus:border-blue-500"
Â  Â  Â  Â  Â  Â  value={quote.title || ""}
Â  Â  Â  Â  Â  Â  onChange={(e) => update("title", e.target.value)}
Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div className="w-48">
Â  Â  Â  Â  Â  <label className="block text-sm text-gray-600 mb-1">å ±åƒ¹å–®ç·¨è™Ÿ</label>
Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  type="text"
Â  Â  Â  Â  Â  Â  className="w-full border rounded px-3 py-2 bg-gray-100"
Â  Â  Â  Â  Â  Â  value={quote.quoteNo || ""}
Â  Â  Â  Â  Â  Â  readOnly
Â  Â  Â  Â  Â  />
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  {/* ---------------- å®¢æˆ¶è³‡è¨Š ---------------- */}
Â  Â  Â  <div className="grid grid-cols-2 gap-4 mb-6">

Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  <label className="block text-sm text-gray-600 mb-1">å®¢æˆ¶åç¨±</label>
Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  type="text"
Â  Â  Â  Â  Â  Â  className="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-blue-300 focus:border-blue-500"
Â  Â  Â  Â  Â  Â  value={quote.customerName || ""}
Â  Â  Â  Â  Â  Â  onChange={(e) => update("customerName", e.target.value)}
Â  Â  Â  Â  Â  />
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  <label className="block text-sm text-gray-600 mb-1">è¯çµ¡äºº</label>
Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  type="text"
Â  Â  Â  Â  Â  Â  className="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-blue-300 focus:border-blue-500"
Â  Â  Â  Â  Â  Â  value={quote.contact || ""}
Â  Â  Â  Â  Â  Â  onChange={(e) => update("contact", e.target.value)}
Â  Â  Â  Â  Â  />
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  <label className="block text-sm text-gray-600 mb-1">é›»è©±</label>
Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  type="text"
Â  Â  Â  Â  Â  Â  className="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-blue-300 focus:border-blue-500"
Â  Â  Â  Â  Â  Â  value={quote.phone || ""}
Â  Â  Â  Â  Â  Â  onChange={(e) => update("phone", e.target.value)}
Â  Â  Â  Â  Â  />
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  <label className="block text-sm text-gray-600 mb-1">å ±åƒ¹æ—¥æœŸ</label>
Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  type="date"
Â  Â  Â  Â  Â  Â  className="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-blue-300 focus:border-blue-500"
Â  Â  Â  Â  Â  Â  // date æ¬„ä½ä½¿ç”¨ yyyy-mm-dd æ ¼å¼
Â  Â  Â  Â  Â  Â  value={quote.date || formatDate()}
Â  Â  Â  Â  Â  Â  onChange={(e) => update("date", e.target.value)}
Â  Â  Â  Â  Â  />
Â  Â  Â  Â  </div>

Â  Â  Â  Â  <div className="col-span-2">
Â  Â  Â  Â  Â  <label className="block text-sm text-gray-600 mb-1">å·¥ç¨‹åœ°é»</label>
Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  type="text"
Â  Â  Â  Â  Â  Â  className="w-full border rounded px-3 py-2 focus:ring-2 focus:ring-blue-300 focus:border-blue-500"
Â  Â  Â  Â  Â  Â  value={quote.location || ""}
Â  Â  Â  Â  Â  Â  onChange={(e) => update("location", e.target.value)}
Â  Â  Â  Â  Â  />
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>
Â  );
}

// P4-3ï¼ˆAï¼‰NoteSubItemBlock â€” è£œå……æ–‡å­— (ä¿®å¾©ä½ç½®)
function NoteSubItemBlock({ sub, updateField, deleteSubItem }) {
  return (
    <div className="border rounded p-3 bg-gray-50 mb-2">
      {/* æ¨™é¡Œ + åˆªé™¤ */}
      <div className="flex justify-between items-center mb-2">
        <span className="text-sm font-bold text-gray-700">ğŸ“„ è£œå……æ–‡å­—</span>
        <button className="text-red-600 text-sm hover:text-red-800" onClick={deleteSubItem}>
          åˆªé™¤
        </button>
      </div>

      <textarea
        className="w-full border rounded p-2 text-sm focus:ring focus:ring-yellow-100"
        rows="2"
        value={sub.text || ""}
        onChange={(e) => updateField("text", e.target.value)}
        placeholder="è¼¸å…¥è£œå……èªªæ˜â€¦"
      />
    </div>
  );
}

// P4-3ï¼ˆXï¼‰SpecItemSuggest â€” è¦æ ¼å“è‡ªå‹•å»ºè­°å…ƒä»¶
function SpecItemSuggest({ currentInput, specItems, onSelect }) {
Â  
Â  // æœå°‹çµæœï¼Œæœ€å¤šé¡¯ç¤º 5 å€‹
Â  const filteredItems = React.useMemo(() => {
Â  Â  const input = (currentInput || "").toLowerCase().trim();

Â  Â  if (input.length < 2) return [];

Â  Â  return specItems
Â  Â  Â  .filter(item => 
Â  Â  Â  Â  // ç¢ºä¿ 'å“å' æ¬„ä½å­˜åœ¨
Â  Â  Â  Â  item['å“å'] && item['å“å'].toLowerCase().includes(input)
Â  Â  Â  )
Â  Â  Â  .slice(0, 5); // æœ€å¤š 5 å€‹
Â  }, [currentInput, specItems]);

Â  if (filteredItems.length === 0) return null;

Â  return (
Â  Â  <div className="absolute z-10 top-full left-0 w-full bg-white border border-gray-300 rounded shadow-lg mt-1 max-h-48 overflow-y-auto">
Â  Â  Â  {filteredItems.map((item, index) => (
Â  Â  Â  Â  <div
Â  Â  Â  Â  Â  key={index}
Â  Â  Â  Â  Â  className="p-2 cursor-pointer hover:bg-blue-100 text-sm border-b last:border-b-0"
Â  Â  Â  Â  Â  onClick={() => onSelect(item)}
Â  Â  Â  Â  >
Â  Â  Â  Â  Â  <div className="font-semibold text-gray-800">{item['å“å']}</div>
Â  Â  Â  Â  Â  <div className="text-xs text-gray-600 truncate">è¦æ ¼: {item['è¦æ ¼']} | å–®åƒ¹: {formatMoney(item['å–®åƒ¹'])}</div>
Â  Â  Â  Â  </div>
Â  Â  Â  ))}
Â  Â  </div>
Â  );
}


// P4-3ï¼ˆBï¼‰ItemSubItemBlock â€” å­é …ç›®ï¼ˆå«æ•¸é‡/å–®åƒ¹ï¼‰ (æ–°å¢è‡ªå‹•å»ºè­°)
function ItemSubItemBlock({ sub, updateField, deleteSubItem }) {
Â  const { specItems } = React.useContext(AppContext); // å–å¾—è¦æ ¼å“åˆ—è¡¨
Â  
Â  // è¨ˆç®—ä¸¦æ ¼å¼åŒ–å°è¨ˆ
Â  const subtotal = formatMoney(calcAmount(sub));

Â  // è™•ç†æ•¸å­—è¼¸å…¥ (Hooks å¿…é ˆæ”¾åœ¨é ‚å±¤)
Â  const handleNumberChange = React.useCallback((field, value) => {
Â  Â  // åªå…è¨±æ•¸å­—æˆ–ç©ºå­—ä¸²
Â  Â  if (value === "" || !isNaN(Number(value))) {
Â  Â  Â  updateField(field, value);
Â  Â  }
Â  }, [updateField]);
Â  
Â  // è™•ç†è¦æ ¼å“é¸æ“‡
Â  const handleSelectSpecItem = React.useCallback((spec) => {
Â  Â  // å¾è¦æ ¼å“æ•¸æ“šè‡ªå‹•å¡«å…¥è¦æ ¼ã€å–®ä½ã€å–®åƒ¹
Â  Â  updateField("name", spec['å“å'] || sub.name);
Â  Â  updateField("spec", spec['è¦æ ¼'] || sub.spec);
Â  Â  updateField("unit", spec['å–®ä½'] || sub.unit);
Â  Â  updateField("price", spec['å–®åƒ¹'] || sub.price);
Â  }, [updateField, sub.name, sub.spec, sub.unit, sub.price]);

Â  return (
Â  Â  <div className="border rounded p-3 bg-gray-50 mb-2">

Â  Â  Â  {/* æ¨™é¡Œ + åˆªé™¤ */}
Â  Â  Â  <div className="flex justify-between items-center mb-2">
Â  Â  Â  Â  <span className="text-sm font-bold text-gray-700">ğŸ“¦ å­é …ç›®</span>
Â  Â  Â  Â  <button className="text-red-600 text-sm hover:text-red-800" onClick={deleteSubItem}>
Â  Â  Â  Â  Â  åˆªé™¤
Â  Â  Â  Â  </button>
Â  Â  Â  Â  
Â  Â  Â  </div>

Â  Â  Â  <div className="grid grid-cols-12 gap-2 text-sm items-center relative">

Â  Â  Â  Â  {/* åç¨± (col-span-3) - **ä½¿ç”¨ SpecItemSuggest** */}
Â  Â  Â  Â  <div className="col-span-3 relative">
Â  Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  Â  className="border p-1 rounded w-full focus:ring focus:ring-blue-100"
Â  Â  Â  Â  Â  Â  value={sub.name || ""}
Â  Â  Â  Â  Â  Â  placeholder="åç¨±"
Â  Â  Â  Â  Â  Â  onChange={(e) => updateField("name", e.target.value)}
Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  <SpecItemSuggest 
Â  Â  Â  Â  Â  Â  currentInput={sub.name} 
Â  Â  Â  Â  Â  Â  specItems={specItems} 
Â  Â  Â  Â  Â  Â  onSelect={handleSelectSpecItem}
Â  Â  Â  Â  Â  />
Â  Â  Â  Â  </div>

Â  Â  Â  Â  {/* è¦æ ¼ (col-span-4) */}
Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  className="border p-1 rounded col-span-4 focus:ring focus:ring-blue-100"
Â  Â  Â  Â  Â  value={sub.spec || ""}
Â  Â  Â  Â  Â  placeholder="è¦æ ¼"
Â  Â  Â  Â  Â  onChange={(e) => updateField("spec", e.target.value)}
Â  Â  Â  Â  />

Â  Â  Â  Â  {/* å–®ä½ (col-span-1) */}
Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  className="border p-1 rounded col-span-1 text-center focus:ring focus:ring-blue-100"
Â  Â  Â  Â  Â  value={sub.unit || ""}
Â  Â  Â  Â  Â  placeholder="å–®ä½"
Â  Â  Â  Â  Â  onChange={(e) => updateField("unit", e.target.value)}
Â  Â  Â  Â  />

Â  Â  Â  Â  {/* æ•¸é‡ (col-span-1) */}
Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  className="border p-1 rounded col-span-1 text-right focus:ring focus:ring-blue-100"
Â  Â  Â  Â  Â  value={sub.qty || ""}
Â  Â  Â  Â  Â  placeholder="æ•¸é‡"
Â  Â  Â  Â  Â  type="number"
Â  Â  Â  Â  Â  min="0"
Â  Â  Â  Â  Â  onChange={(e) => handleNumberChange("qty", e.target.value)}
Â  Â  Â  Â  />

Â  Â  Â  Â  {/* å–®åƒ¹ (col-span-2) */}
Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  className="border p-1 rounded col-span-2 text-right focus:ring focus:ring-blue-100"
Â  Â  Â  Â  Â  value={sub.price || ""}
Â  Â  Â  Â  Â  placeholder="å–®åƒ¹"
Â  Â  Â  Â  Â  type="number"
Â  Â  Â  Â  Â  min="0"
Â  Â  Â  Â  Â  onChange={(e) => handleNumberChange("price", e.target.value)}
Â  Â  Â  Â  />

Â  Â  Â  Â  {/* å°è¨ˆ (col-span-1) */}
Â  Â  Â  Â  <div className="col-span-1 text-right font-bold text-blue-600">
Â  Â  Â  Â  Â  {subtotal}
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>
Â  );
}


// P4-3ï¼ˆCï¼‰ImageSubItemBlock â€” åœ–ç‰‡å°é …
function ImageSubItemBlock({ sub, updateField, deleteSubItem }) {
Â  // åœ–ç‰‡ä¸Šå‚³è™•ç† (ä¸æ˜¯ Hookï¼Œä¸éœ€è¦æå‡)
Â  function handleUpload(e) {
Â  Â  const file = e.target.files[0];
Â  Â  if (!file) return;

Â  Â  const reader = new FileReader();
Â  Â  reader.onload = () => updateField("src", reader.result);
Â  Â  reader.readAsDataURL(file);
Â  Â  e.target.value = ''; // æ¸…ç©ºæª”æ¡ˆè¼¸å…¥ï¼Œä»¥ä¾¿é‡æ–°é¸æ“‡åŒä¸€æª”æ¡ˆ
Â  }

Â  return (
Â  Â  <div className="border rounded p-3 bg-gray-50 mb-2">

Â  Â  Â  <div className="flex justify-between items-center mb-2">
Â  Â  Â  Â  <span className="text-sm font-bold text-gray-700">ğŸ“· åœ–ç‰‡è£œå……</span>
Â  Â  Â  Â  <button className="text-red-600 text-sm hover:text-red-800" onClick={deleteSubItem}>åˆªé™¤</button>
Â  Â  Â  </div>

Â  Â  Â  {/*åœ–ç‰‡é è¦½*/}
Â  Â  Â  {sub.src ? (
Â  Â  Â  Â  <img src={sub.src} className="max-w-xs mb-2 border rounded shadow" alt="é è¦½åœ–" />
Â  Â  Â  ) : (
Â  Â  Â  Â  <div className="text-gray-500 text-sm mb-2 p-2 border border-dashed rounded bg-white">å°šæœªä¸Šå‚³åœ–ç‰‡</div>
Â  Â  Â  )}

Â  Â  Â  {/* ä¸Šå‚³æŒ‰éˆ• */}
Â  Â  Â  <label className="cursor-pointer text-blue-700 underline text-sm hover:text-blue-900">
Â  Â  Â  Â  {sub.src ? "æ›´æ›åœ–ç‰‡" : "ä¸Šå‚³åœ–ç‰‡"}
Â  Â  Â  Â  <input type="file" accept="image/*" className="hidden" onChange={handleUpload} />
Â  Â  Â  </label>
Â  Â  </div>
Â  );
}


// P4-3ï¼ˆDï¼‰UploadImageButton â€” åœ¨åº•éƒ¨æ–°å¢åœ–ç‰‡ç”¨
function UploadImageButton({ onUpload }) {
Â  // åœ–ç‰‡ä¸Šå‚³è™•ç† (ä¸æ˜¯ Hookï¼Œä¸éœ€è¦æå‡)
Â  function handleSelect(e) {
Â  Â  const file = e.target.files[0];
Â  Â  if (!file) return;

Â  Â  const reader = new FileReader();
Â  Â  reader.onload = () => onUpload(reader.result);
Â  Â  reader.readAsDataURL(file);
Â  Â  e.target.value = ''; // æ¸…ç©ºæª”æ¡ˆè¼¸å…¥ï¼Œä»¥ä¾¿é‡æ–°é¸æ“‡åŒä¸€æª”æ¡ˆ
Â  }

Â  return (
Â  Â  <label className="cursor-pointer text-blue-600 hover:text-blue-800 transition">
Â  Â  Â  ï¼‹è£œå……åœ–ç‰‡
Â  Â  Â  <input type="file" accept="image/*" className="hidden" onChange={handleSelect} />
Â  Â  </label>
Â  );
}


// P4-3ï¼ˆEï¼‰SubItemWrapper â€” è‡ªå‹•åˆ†æµå°é …é¡å‹
function SubItemWrapper({ subItem, parentItem, quote, updateQuote }) {

Â  // æ›´æ–°æŸå€‹ subItem çš„ç‰¹å®šæ¬„ä½ (Hooks å¿…é ˆæ”¾åœ¨é ‚å±¤)
Â  const updateField = React.useCallback((field, value) => {
Â  Â  const newItems = quote.items.map(m =>
Â  Â  Â  m.id === parentItem.id
Â  Â  Â  Â  ? {
Â  Â  Â  Â  Â  ...m,
Â  Â  Â  Â  Â  // ç¢ºä¿ subItems å­˜åœ¨
Â  Â  Â  Â  Â  subItems: (m.subItems || []).map(s =>
Â  Â  Â  Â  Â  Â  s.id === subItem.id ? { ...s, [field]: value } : s
Â  Â  Â  Â  Â  )
Â  Â  Â  Â  }
Â  Â  Â  Â  : m
Â  Â  );
Â  Â  updateQuote(quote.id, { items: newItems });
Â  }, [quote.id, parentItem.id, subItem.id, quote.items, updateQuote]);

Â  // åˆªé™¤ subItem (Hooks å¿…é ˆæ”¾åœ¨é ‚å±¤)
Â  const deleteSubItem = React.useCallback(() => {
Â  Â  const newItems = quote.items.map(m =>
Â  Â  Â  m.id === parentItem.id
Â  Â  Â  Â  ? { ...m, subItems: (m.subItems || []).filter(s => s.id !== subItem.id) }
Â  Â  Â  Â  : m
Â  Â  );
Â  Â  updateQuote(quote.id, { items: newItems });
Â  }, [quote.id, parentItem.id, subItem.id, quote.items, updateQuote]);

Â  const props = { sub: subItem, updateField, deleteSubItem };

Â  if (subItem.type === "note") return <NoteSubItemBlock {...props} />;
Â  if (subItem.type === "item") return <ItemSubItemBlock {...props} />;
Â  if (subItem.type === "image") return <ImageSubItemBlock {...props} />;

Â  return null;
}


// P4-3ï¼ˆFï¼‰MainItemBlock â€” å¤§é …ç·¨è¼¯ (ä¿®æ­£æ’ç‰ˆ + è‡ªå‹•å»ºè­°åŠŸèƒ½)
function MainItemBlock({ item, quote, updateQuote }) {
Â  const { specItems } = React.useContext(AppContext);

Â  // 1. æ›´æ–°å¤§é …è³‡æ–™ (Hooks å¿…é ˆæ”¾åœ¨é ‚å±¤)
Â  const update = React.useCallback((data) => {
Â  Â  // ç¢ºä¿åªæ›´æ–°ç•¶å‰é …ç›®
Â  Â  const newItems = quote.items.map(m =>
Â  Â  Â  m.id === item.id ? { ...m, ...data } : m
Â  Â  );
Â  Â  updateQuote(quote.id, { items: newItems });
Â  }, [quote.id, item.id, quote.items, updateQuote]);

Â  // 2. è™•ç†æ•¸å­—è¼¸å…¥ (Hooks å¿…é ˆæ”¾åœ¨é ‚å±¤)
Â  const handleNumberChange = React.useCallback((field, value) => {
Â  Â  // å…è¨±ç©ºå­—ä¸²æˆ–æ•¸å­—
Â  Â  if (value === "" || !isNaN(Number(value))) {
Â  Â  Â  update({ [field]: value });
Â  Â  }
Â  }, [update]);

Â  // 3. åˆªé™¤å¤§é … (Hooks å¿…é ˆæ”¾åœ¨é ‚å±¤)
Â  const deleteMain = React.useCallback(() => {
Â  Â  if (!confirm("ç¢ºå®šè¦åˆªé™¤æ­¤å¤§é …ï¼Ÿ")) return;
Â  Â  updateQuote(quote.id, { items: quote.items.filter(m => m.id !== item.id) });
Â  }, [quote.id, item.id, quote.items, updateQuote]);

Â  // 4. æ–°å¢å°é … (Hooks å¿…é ˆæ”¾åœ¨é ‚å±¤)
Â  const addSub = React.useCallback((type, src = "") => {
Â  Â  const newSub = {
Â  Â  Â  id: uuid(),
Â  Â  Â  type,
Â  Â  Â  text: "",
Â  Â  Â  name: "",
Â  Â  Â  spec: "",
Â  Â  Â  unit: "",
Â  Â  Â  qty: "",
Â  Â  Â  price: "",
Â  Â  Â  src
Â  Â  };

Â  Â  const newItems = quote.items.map(m =>
Â  Â  Â  m.id === item.id ? { ...m, subItems: [...(m.subItems || []), newSub] } : m
Â  Â  );

Â  Â  updateQuote(quote.id, { items: newItems });
Â  }, [quote.id, item.id, quote.items, updateQuote]);

Â  // 5. è™•ç†è¦æ ¼å“é¸æ“‡
Â  const handleSelectSpecItem = React.useCallback((spec) => {
Â  Â  // å¾è¦æ ¼å“æ•¸æ“šè‡ªå‹•å¡«å…¥è¦æ ¼ã€å–®ä½ã€å–®åƒ¹
Â  Â  update({
Â  Â  Â  name: spec['å“å'] || item.name,
Â  Â  Â  spec: spec['è¦æ ¼'] || item.spec,
Â  Â  Â  unit: spec['å–®ä½'] || item.unit,
Â  Â  Â  price: spec['å–®åƒ¹'] || item.price,
Â  Â  });
Â  }, [update, item.name, item.spec, item.unit, item.price]);

Â  // è¨ˆç®—ä¸¦æ ¼å¼åŒ–å°è¨ˆ (ä¸æ˜¯ Hookï¼Œæ”¾åœ¨ Hook ä¹‹å¾Œ)
Â  const mainTotal = formatMoney(calcAmount(item));

Â  return (
Â  Â  <div className="border rounded p-4 bg-white shadow mb-4">

Â  Â  Â  {/* VVVV æ¨™é¡Œè¡Œ VVVV */}
Â  Â  Â  <div className="grid grid-cols-12 gap-2 text-sm font-bold text-gray-600 mb-2 border-b pb-1">
Â  Â  Â  Â  Â  <div className="col-span-3 text-left">å“å</div>
Â  Â  Â  Â  Â  <div className="col-span-3 text-left">è¦æ ¼</div>
Â  Â  Â  Â  Â  <div className="col-span-1 text-center">å–®ä½</div>
Â  Â  Â  Â  Â  <div className="col-span-1 text-right">æ•¸é‡</div>
Â  Â  Â  Â  Â  <div className="col-span-2 text-right">å–®åƒ¹</div>
Â  Â  Â  Â  Â  <div className="col-span-1 text-right">å°è¨ˆ</div>
Â  Â  Â  Â  Â  <div className="col-span-1"></div> {/* åˆªé™¤æŒ‰éˆ•æ¬„ä½ */}
Â  Â  Â  </div>

Â  Â  Â  {/* å¤§é …è³‡æ–™åˆ— */}
Â  Â  Â  <div className="grid grid-cols-12 gap-2 items-center">
Â  Â  Â  Â  {/* å“å (col-span-3) - **ä½¿ç”¨ SpecItemSuggest** */}
Â  Â  Â  Â  <div className="col-span-3 relative">
Â  Â  Â  Â  Â  <input className="border p-1 rounded w-full focus:ring focus:ring-red-100 text-left"
Â  Â  Â  Â  Â  Â  value={item.name || ""} placeholder="å“å"
Â  Â  Â  Â  Â  Â  onChange={(e) => update({ name: e.target.value })} 
Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  <SpecItemSuggest 
Â  Â  Â  Â  Â  Â  currentInput={item.name} 
Â  Â  Â  Â  Â  Â  specItems={specItems} 
Â  Â  Â  Â  Â  Â  onSelect={handleSelectSpecItem}
Â  Â  Â  Â  Â  />
Â  Â  Â  Â  </div>
Â  Â  Â  Â  {/* è¦æ ¼ (col-span-3) */}
Â  Â  Â  Â  <input className="border p-1 rounded col-span-3 focus:ring focus:ring-red-100 text-left"
Â  Â  Â  Â  Â  value={item.spec || ""} placeholder="è¦æ ¼"
Â  Â  Â  Â  Â  onChange={(e) => update({ spec: e.target.value })} />
Â  Â  Â  Â  {/* å–®ä½ (col-span-1) */}
Â  Â  Â  Â  <input className="border p-1 rounded col-span-1 text-center focus:ring focus:ring-red-100"
Â  Â  Â  Â  Â  value={item.unit || ""} placeholder="å–®ä½"
Â  Â  Â  Â  Â  onChange={(e) => update({ unit: e.target.value })} />
Â  Â  Â  Â  {/* æ•¸é‡ (col-span-1) */}
Â  Â  Â  Â  <input className="border p-1 rounded col-span-1 text-right focus:ring focus:ring-red-100"
Â  Â  Â  Â  Â  value={item.qty || ""} placeholder="æ•¸é‡"
Â  Â  Â  Â  Â  type="number" min="0"
Â  Â  Â  Â  Â  onChange={(e) => handleNumberChange("qty", e.target.value)} />
Â  Â  Â  Â  {/* å–®åƒ¹ (col-span-2) */}
Â  Â  Â  Â  <input className="border p-1 rounded col-span-2 text-right focus:ring focus:ring-red-100"
Â  Â  Â  Â  Â  value={item.price || ""} placeholder="å–®åƒ¹"
Â  Â  Â  Â  Â  type="number" min="0"
Â  Â  Â  Â  Â  onChange={(e) => handleNumberChange("price", e.target.value)} />

Â  Â  Â  Â  {/* å°è¨ˆ (col-span-1) */}
Â  Â  Â  Â  <div className="text-right font-bold col-span-1 text-red-700">
Â  Â  Â  Â  Â  {mainTotal}
Â  Â  Â  Â  </div>
Â  Â  Â  Â  {/* åˆªé™¤æŒ‰éˆ• (col-span-1) */}
Â  Â  Â  Â  <button className="text-red-600 col-span-1 text-sm hover:text-red-800" onClick={deleteMain}>
Â  Â  Â  Â  Â  âœ•
Â  Â  Â  Â  </button>
Â  Â  Â  </div>

Â  Â  Â  {/* å°é …åˆ—è¡¨ */}
Â  Â  Â  <div className="mt-3 border-t pt-3">
Â  Â  Â  Â  {(item.subItems || []).map(sub => ( // ç¢ºä¿ subItems å­˜åœ¨
Â  Â  Â  Â  Â  <SubItemWrapper
Â  Â  Â  Â  Â  Â  key={sub.id} 
Â  Â  Â  Â  Â  Â  subItem={sub}
Â  Â  Â  Â  Â  Â  parentItem={item}
Â  Â  Â  Â  Â  Â  quote={quote}
Â  Â  Â  Â  Â  Â  updateQuote={updateQuote}
Â  Â  Â  Â  Â  />
Â  Â  Â  Â  ))}
Â  Â  Â  </div>

Â  Â  Â  {/* æ“ä½œåˆ— */}
Â  Â  Â  <div className="flex gap-4 mt-3 text-blue-600 text-sm border-t pt-3">
Â  Â  Â  Â  <button className="hover:text-blue-800 transition" onClick={() => addSub("item")}>ï¼‹ å­é …ç›®</button>
Â  Â  Â  Â  <button className="hover:text-blue-800 transition" onClick={() => addSub("note")}>ï¼‹ è£œå……æ–‡å­—</button>
Â  Â  Â  Â  <UploadImageButton onUpload={(src) => addSub("image", src)} />
Â  Â  Â  </div>
Â  Â  </div>
Â  );
}
// P4-3ï¼ˆGï¼‰ItemsEditor â€” æ•´é«”å“é …ç®¡ç†
function ItemsEditor({ quote, updateQuote }) {
Â  // 1. æ–°å¢å¤§é … (Hooks å¿…é ˆæ”¾åœ¨é ‚å±¤)
Â  const addMain = React.useCallback(() => {
Â  Â  const newMain = {
Â  Â  Â  id: uuid(),
Â  Â  Â  type: "main",
Â  Â  Â  name: "æœªå‘½åå¤§é …",
Â  Â  Â  spec: "",
Â  Â  Â  unit: "",
Â  Â  Â  qty: "",
Â  Â  Â  price: "",
Â  Â  Â  subItems: []
Â  Â  };
Â  Â  updateQuote(quote.id, { items: [...(quote.items || []), newMain] });
Â  }, [quote.id, quote.items, updateQuote]);

Â  return (
Â  Â  <div className="mb-6 no-print">
Â  Â  Â  <h2 className="font-bold text-lg mb-2">å ±åƒ¹é …ç›®åˆ—è¡¨</h2>
Â  Â  Â  
Â  Â  Â  <button
Â  Â  Â  Â  className="px-4 py-2 bg-blue-600 text-white rounded mb-4 hover:bg-blue-700 transition"
Â  Â  Â  Â  onClick={addMain}
Â  Â  Â  >
Â  Â  Â  Â  ï¼‹ æ–°å¢å·¥ç¨‹å¤§é …
Â  Â  Â  </button>
Â  Â  Â Â 
Â  Â  Â  {/* æ¸²æŸ“æ‰€æœ‰å¤§é … */}
Â  Â  Â  {(quote.items || []).map(item => (
Â  Â  Â  Â  <MainItemBlock
Â  Â  Â  Â  Â  key={item.id}
Â  Â  Â  Â  Â  item={item}
Â  Â  Â  Â  Â  quote={quote}
Â  Â  Â  Â  Â  updateQuote={updateQuote}
Â  Â  Â  Â  />
Â  Â  Â  ))}

Â  Â  Â  {quote.items.length === 0 && (
Â  Â  Â  Â  <div className="text-gray-500 text-sm text-center p-4 border border-dashed rounded">
Â  Â  Â  Â  Â  é»æ“Šä¸Šæ–¹æŒ‰éˆ•é–‹å§‹æ–°å¢å ±åƒ¹é …ç›®
Â  Â  Â  Â  Â  
Â  Â  Â  Â  </div>
Â  Â  Â  )}
Â  Â  </div>
Â  );
}

// P5-1 â€” NotesEditorï¼ˆå‚™è¨»èªªæ˜ï¼‰
function NotesEditor({ quote, update }) {
Â  return (
Â  Â  <div className="bg-white p-4 shadow rounded h-full flex flex-col">
Â  Â  Â  <h3 className="font-bold mb-2">å‚™è¨»èªªæ˜ (ä¸å«ç¨…)</h3>
Â  Â  Â  <textarea
Â  Â  Â  Â  className="w-full border rounded p-2 text-sm flex-1 whitespace-pre-wrap"
Â  Â  Â  Â  rows="10"
Â  Â  Â  Â  value={quote.notes || ""}
Â  Â  Â  Â  onChange={(e) => update("notes", e.target.value)}
Â  Â  Â  Â  placeholder="è¼¸å…¥å‚™è¨»èªªæ˜..."
Â  Â  Â  />
Â  Â  </div>
Â  );
}

// P5-2 â€” PaymentEditorï¼ˆä»˜æ¬¾æ¢ä»¶ï¼‰
function PaymentEditor({ quote, update }) {
Â  return (
Â  Â  <div className="bg-white p-4 shadow rounded h-full flex flex-col">
Â  Â  Â  <h3 className="font-bold mb-2">ä»˜æ¬¾æ¢ä»¶ (æœªå«ç¨…)</h3>
Â  Â  Â  <textarea
Â  Â  Â  Â  className="w-full border rounded p-2 text-sm flex-1 whitespace-pre-wrap"
Â  Â  Â  Â  rows="10"
Â  Â  Â  Â  value={quote.payment || ""}
Â  Â  Â  Â  onChange={(e) => update("payment", e.target.value)}
Â  Â  Â  Â  placeholder="è¼¸å…¥ä»˜æ¬¾æ¢ä»¶..."
Â  Â  Â  />
Â  Â  </div>
Â  );
}

// P5-3 â€” PriceSummaryï¼ˆç¸½åƒ¹æ‘˜è¦ï¼‰
function PriceSummary({ quote, update }) {
Â  // è¨ˆç®—ç¸½é‡‘é¡
Â  const total = calcTotal(quote.items || []);
Â  // è¨ˆç®—è­°å®šå¾Œåƒ¹æ ¼
Â  const negotiated = calcNegotiated(total, quote.discountPercent, quote.negotiatedPrice);

Â  // è™•ç†æ•¸å­—è¼¸å…¥ (Hooks å¿…é ˆæ”¾åœ¨é ‚å±¤)
Â  const handleNumberChange = React.useCallback((field, value) => {
Â  Â  if (value === "" || !isNaN(Number(value))) {
Â  Â  Â  update(field, value);
Â  Â  }
Â  }, [update]);

Â  return (
Â  Â  <div className="bg-white p-4 shadow rounded">
Â  Â  Â  <h3 className="font-bold mb-3">ç¸½åƒ¹æ‘˜è¦</h3>

Â  Â  Â  {/* ç¸½é¡ (æœªç¨…) */}
Â  Â  Â  <div className="flex justify-between items-center mb-2 p-2 border-b">
Â  Â  Â  Â  <span className="text-gray-600">ç¸½é‡‘é¡ (æœªç¨…)</span>
Â  Â  Â  Â  <span className="font-bold text-lg text-green-700">
Â  Â  Â  Â  Â  {formatMoney(total)}
Â  Â  Â  Â  </span>
Â  Â  Â  Â  
Â  Â  Â  </div>

Â  Â  Â  {/* æŠ˜æ‰£ç™¾åˆ†æ¯” */}
Â  Â  Â  <div className="flex items-center mb-2">
Â  Â  Â  Â  <label className="text-gray-600 w-24">æŠ˜æ‰£ (%)</label>
Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  type="number"
Â  Â  Â  Â  Â  className="w-20 border rounded px-2 py-1 text-right focus:ring-2 focus:ring-blue-300"
Â  Â  Â  Â  Â  min="0"
Â  Â  Â  Â  Â  max="100"
Â  Â  Â  Â  Â  value={quote.discountPercent || ""}
Â  Â  Â  Â  Â  onChange={(e) => handleNumberChange("discountPercent", e.target.value)}
Â  Â  Â  Â  />
Â  Â  Â  Â  <span className="ml-2 text-sm text-gray-500"> (è¼¸å…¥ 10 å³æ‰“ä¹æŠ˜)</span>
Â  Â  Â  </div>
Â  Â  Â  
Â  Â  Â  {/* è­°å®šåƒ¹æ ¼ (å¯è¦†è“‹æŠ˜æ‰£) */}
Â  Â  Â  <div className="flex items-center mb-4">
Â  Â  Â  Â  <label className="text-gray-600 w-24">è­°å®šåƒ¹æ ¼</label>
Â  Â  Â  Â  <input
Â  Â  Â  Â  Â  type="number"
Â  Â  Â  Â  Â  className="flex-1 border rounded px-2 py-1 text-right focus:ring-2 focus:ring-blue-300"
Â  Â  Â  Â  Â  min="0"
Â  Â  Â  Â  Â  value={quote.negotiatedPrice || ""}
Â  Â  Â  Â  Â  onChange={(e) => handleNumberChange("negotiatedPrice", e.target.value)}
Â  Â  Â  Â  />
Â  Â  Â  </div>

Â  Â  Â  {/* æœ€çµ‚åƒ¹æ ¼ (æœªç¨…) */}
Â  Â  Â  <div className="flex justify-between items-center p-3 rounded bg-blue-50 border border-blue-200">
Â  Â  Â  Â  <span className="text-blue-800 font-semibold">æœ€çµ‚å ±åƒ¹ (æœªç¨…)</span>
Â  Â  Â  Â  <span className="font-extrabold text-xl text-blue-800">
Â  Â  Â  Â  Â  {formatMoney(negotiated)}
Â  Â  Â  Â  </span>
Â  Â  Â  </div>
Â  Â  </div>
Â  );
}

// P6 â€” Excel åŒ¯å‡ºåŠŸèƒ½
function exportToExcel(quote, companyInfo) {
Â  
Â  if (!quote) {
Â  Â  alert("è«‹å…ˆé¸æ“‡æˆ–å»ºç«‹ä¸€ä»½å ±åƒ¹å–®ã€‚");
Â  Â  return;
Â  }

Â  // è¨ˆç®—ç¸½é¡
Â  const total = calcTotal(quote.items || []);
Â  const negotiated = calcNegotiated(total, quote.discountPercent, quote.negotiatedPrice);

Â  // Excel è¡¨é ­
Â  const header = [
Â  Â  "é …æ¬¡", "å“å", "è¦æ ¼", "å–®ä½", "æ•¸é‡", "å–®åƒ¹", "é‡‘é¡", "å‚™è¨»"
Â  ];

Â  // å ±åƒ¹å–®å…§å®¹è¡¨æ ¼æ•¸æ“š
Â  const data = [];

Â  let itemIndex = 1;

Â  // è¿­ä»£æ‰€æœ‰å¤§é …å’Œå…¶å­é …
Â  (quote.items || []).forEach(item => {
Â  Â  // è™•ç†å¤§é … (MainItemBlock)
Â  Â  data.push([
Â  Â  Â  itemIndex++,
Â  Â  Â  item.name || "",
Â  Â  Â  item.spec || "",
Â  Â  Â  item.unit || "",
Â  Â  Â  Number(item.qty) || "",
Â  Â  Â  Number(item.price) || "",
Â  Â  Â  calcAmount(item),
Â  Â  Â  "" // å‚™è¨»æ¬„ä½
Â  Â  ]);

Â  Â  // è™•ç†å°é … (SubItems)
Â  Â  (item.subItems || []).forEach(sub => {
Â  Â  Â  if (sub.type === 'item') {
Â  Â  Â  Â  // æ¨™æº–å­é …ç›® (ItemSubItemBlock)
Â  Â  Â  Â  data.push([
Â  Â  Â  Â  Â  "", // å­é …ç›®ä¸å¯«é …æ¬¡
Â  Â  Â  Â  Â  ` â†³ ${sub.name || ""}`, // ä½¿ç”¨ç¸®æ’ç¬¦è™Ÿ
Â  Â  Â  Â  Â  sub.spec || "",
Â  Â  Â  Â  Â  sub.unit || "",
Â  Â  Â  Â  Â  Number(sub.qty) || "",
Â  Â  Â  Â  Â  Number(sub.price) || "",
Â  Â  Â  Â  Â  calcAmount(sub),
Â  Â  Â  Â  Â  ""
Â  Â  Â  Â  ]);
Â  Â  Â  } else if (sub.type === 'note' && sub.text) {
Â  Â  Â  Â  // å‚™è¨»å°é … (NoteSubItemBlock)
Â  Â  Â  Â  // å‚™è¨»å…§å®¹æ”¾åœ¨å‚™è¨»æ¬„ä½
Â  Â  Â  Â  data.push([
Â  Â  Â  Â  Â  "",
Â  Â  Â  Â  Â  `å‚™è¨»ï¼š${sub.text}`, 
Â  Â  Â  Â  Â  "", "", "", "", "", // å…¶å®ƒæ¬„ä½ç•™ç©º
Â  Â  Â  Â  Â  ""
Â  Â  Â  Â  ]);
Â  Â  Â  }
Â  Â  Â  // åœ–ç‰‡ (image) é¡å‹åœ¨ Excel ä¸­ä¸è™•ç†
Â  Â  });
Â  });


Â  // æ§‹é€ æœ€çµ‚å·¥ä½œè¡¨æ•¸æ“š (åŒ…å«æŠ¬é ­è³‡è¨Š)
Â  const sheetData = [
Â  Â  [companyInfo.name, "å·¥ç¨‹å ±åƒ¹å–®"],
Â  Â  ["å·¥ç¨‹åç¨±:", quote.title || ""],
Â  Â  ["å®¢æˆ¶åç¨±:", quote.customerName || ""],
Â  Â  ["è¯çµ¡äºº:", quote.contact || ""],
Â  Â  ["é›»è©±:", quote.phone || ""],
Â  Â  ["å ±åƒ¹æ—¥æœŸ:", quote.date || ""],
Â  Â  ["å·¥ç¨‹åœ°é»:", quote.location || ""],
Â  Â  [],
Â  Â  header, // é …ç›®è¡¨æ ¼è¡¨é ­
Â  Â  ...data, // é …ç›®è¡¨æ ¼å…§å®¹
Â  Â  [],
Â  Â  ["ç¸½é‡‘é¡ (æœªç¨…)", "", "", "", "", "", total],
Â  Â  ["æŠ˜æ‰£ (%)", quote.discountPercent || 0, "", "è­°å®šåƒ¹æ ¼ (æœªç¨…)", negotiated],
Â  Â  ["æœ€çµ‚å ±åƒ¹ (æœªç¨…)", negotiated],
Â  Â  [],
Â  Â  ["å‚™è¨»èªªæ˜", quote.notes || ""],
Â  Â  ["ä»˜æ¬¾æ¢ä»¶", quote.payment || ""]
Â  ];

Â  // å°‡æ•¸æ“šè½‰æ›ç‚ºå·¥ä½œç°¿
Â  const ws = XLSX.utils.aoa_to_sheet(sheetData);

Â  // --- è¨­ç½®æ¬„ä½å¯¬åº¦ (å¯é¸) ---
Â  const wscols = [
Â  Â  { wch: 6 }, // é …æ¬¡
Â  Â  { wch: 30 }, // å“å
Â  Â  { wch: 35 }, // è¦æ ¼
Â  Â  { wch: 8 }, Â // å–®ä½
Â  Â  { wch: 8 }, Â // æ•¸é‡ (æ•¸å­—)
Â  Â  { wch: 12 }, // å–®åƒ¹ (æ•¸å­—)
Â  Â  { wch: 15 }, // é‡‘é¡ (æ•¸å­—)
Â  Â  { wch: 20 } Â // å‚™è¨»
Â  ];
Â  ws['!cols'] = wscols;


Â  // --- è¨­ç½®å–®å…ƒæ ¼æ ¼å¼ (å¯é¸) ---
Â  // é‡‘é¡æ¬„ä½è‡ªå‹•è¨­ç‚ºæ•¸å­—æ ¼å¼
Â  for (let i = 0; i < data.length; i++) {
Â  Â  const rowIndex = i + 10; // æ•¸æ“šå¾ç¬¬ 10 è¡Œé–‹å§‹ (0-based: 9)
Â  Â  const cellAddress = 'G' + rowIndex; // é‡‘é¡æ¬„ä½æ˜¯ G æ¬„
Â  Â  const cell = ws[cellAddress];
Â  Â  
Â  Â  if (cell && cell.v !== "") {
Â  Â  Â  // è¨­ç‚ºæ•¸å­—æ ¼å¼ï¼Œæ–¹ä¾¿ Excel è‡ªå‹•è¨ˆç®—
Â  Â  Â  cell.t = 'n'; 
Â  Â  Â  cell.z = "#,##0"; // è¨­å®šåƒä½åˆ†éš”ç¬¦
Â  Â  }
Â  }

Â  const wb = XLSX.utils.book_new();
Â  XLSX.utils.book_append_sheet(wb, ws, "å ±åƒ¹å–®å…§å®¹");

Â  // åŒ¯å‡ºæª”æ¡ˆ
Â  const fileName = `${quote.quoteNo}_${quote.customerName || 'å®¢æˆ¶'}.xlsx`;
Â  XLSX.writeFile(wb, fileName);
Â  
Â  console.log(`Excel åŒ¯å‡ºæˆåŠŸ: ${fileName}`);
}

// Excel åŒ¯å‡ºæŒ‰éˆ•å…ƒä»¶
function ExcelExporter() {
Â  const { activeQuote, company } = React.useContext(AppContext);
Â  const companyInfo = COMPANY_DATA[company];
Â  
Â  // è™•ç†é»æ“ŠåŒ¯å‡º
Â  const handleExport = React.useCallback(() => {
Â  Â  exportToExcel(activeQuote, companyInfo);
Â  }, [activeQuote, companyInfo]);


Â  return (
Â  Â  <button 
Â  Â  Â  className="w-full px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600 transition shadow-md no-print"
Â  Â  Â  onClick={handleExport}
Â  Â  Â  disabled={!activeQuote} // å¦‚æœæ²’æœ‰å ±åƒ¹å–®å‰‡ç¦ç”¨
Â  Â  >
Â  Â  Â  â¬‡ï¸ åŒ¯å‡º Excel (XLSX)
Â  Â  </button>
Â  );
}

// P7 â€” åˆ—å°åŠŸèƒ½ (æ–°å¢)
function PrintButton() {
Â  const { activeQuote } = React.useContext(AppContext);

Â  const handlePrint = React.useCallback(() => {
Â  Â  if (!activeQuote) {
Â  Â  Â  alert("è«‹å…ˆé¸æ“‡æˆ–å»ºç«‹ä¸€ä»½å ±åƒ¹å–®ã€‚");
Â  Â  Â  return;
Â  Â  }

Â  Â  // 1. éš±è—ç·¨è¼¯å€ï¼Œé¡¯ç¤ºåˆ—å°å€
Â  Â  const root = document.getElementById("root");
Â  Â  const printArea = document.getElementById("printArea");
Â  Â  
Â  Â  if (root) root.style.display = 'none'; // ç”± CSS è™•ç†
Â  Â  if (printArea) printArea.innerHTML = ReactDOMServer.renderToString(<PrintLayout quote={activeQuote} />);

Â  Â  // 2. è§¸ç™¼ç€è¦½å™¨åˆ—å°å°è©±æ¡†
Â  Â  window.print();

Â  Â  // 3. åˆ—å°çµæŸå¾Œæ¢å¾©ç·¨è¼¯å€
Â  Â  // ç”±æ–¼ window.print() æ˜¯åŒæ­¥é˜»å¡çš„ï¼Œæˆ‘å€‘ä½¿ç”¨ setTimeout ç¢ºä¿æ¢å¾©
Â  Â  setTimeout(() => {
Â  Â  Â  if (root) root.style.display = 'block'; // ç”± CSS è™•ç†
Â  Â  Â  if (printArea) printArea.innerHTML = '';
Â  Â  }, 100);

Â  }, [activeQuote]);


Â  return (
Â  Â  <button 
Â  Â  Â  className="w-full px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 transition shadow-md no-print mb-4"
Â  Â  Â  onClick={handlePrint}
Â  Â  Â  disabled={!activeQuote}
Â  Â  >
Â  Â  Â  ğŸ–¨ï¸ åˆ—å°å ±åƒ¹å–®
Â  Â  </button>
Â  );
}

// å ±åƒ¹å–®é …ç›®åˆ—å°å…ƒä»¶ (ç”¨æ–¼ PrintLayout)
function PrintItemRow({ item, index, isSub = false }) {
Â  
Â  const amount = calcAmount(item);
Â  
Â  let nameContent;
Â  
Â  if (item.type === 'note' && item.text) {
Â  Â  // è£œå……æ–‡å­—
Â  Â  return (
Â  Â  Â  <tr>
Â  Â  Â  Â  <td colSpan="7" style={{ borderTop: 'none' }}>
Â  Â  Â  Â  Â  **è£œå……èªªæ˜:** <span style={{ whiteSpace: 'pre-wrap' }}>{item.text}</span>
Â  Â  Â  Â  </td>
Â  Â  Â  </tr>
Â  Â  );
Â  } else if (item.type === 'image' && item.src) {
Â  Â  // åœ–ç‰‡
Â  Â  return (
Â  Â  Â  <tr>
Â  Â  Â  Â  <td colSpan="7" style={{ borderTop: 'none' }}>
Â  Â  Â  Â  Â  <img src={item.src} alt="å·¥ç¨‹åœ–ç‰‡" className="print-image" />
Â  Â  Â  Â  </td>
Â  Â  Â  </tr>
Â  Â  );
Â  }
Â  
Â  // æ¨™æº–å¤§é …æˆ–å­é …ç›®
Â  const namePrefix = isSub ? ' â†³ ' : '';
Â  
Â  return (
Â  Â  <React.Fragment>
Â  Â  Â  <tr className={!isSub ? "font-bold" : ""}>
Â  Â  Â  Â  <td style={{ width: '5%', textAlign: 'center' }}>{isSub ? '' : index}</td>
Â  Â  Â  Â  <td style={{ width: '25%' }}>{namePrefix}{item.name || ''}</td>
Â  Â  Â  Â  <td style={{ width: '30%' }}>{item.spec || ''}</td>
Â  Â  Â  Â  <td style={{ width: '8%', textAlign: 'center' }}>{item.unit || ''}</td>
Â  Â  Â  Â  <td style={{ width: '8%', textAlign: 'right' }}>{item.qty || ''}</td>
Â  Â  Â  Â  <td style={{ width: '12%', textAlign: 'right' }}>{formatMoney(item.price)}</td>
Â  Â  Â  Â  <td style={{ width: '12%', textAlign: 'right' }}>{formatMoney(amount)}</td>
Â  Â  Â  </tr>
Â  Â  Â  
Â  Â  Â  {/* éæ­¸è™•ç†å­é …ç›® */}
Â  Â  Â  {!isSub && (item.subItems || []).map((sub, subIndex) => (
Â  Â  Â  Â  <PrintItemRow key={sub.id} item={sub} index={subIndex} isSub={true} />
Â  Â  Â  ))}
Â  Â  </React.Fragment>
Â  );
}

// å®Œæ•´åˆ—å°ç‰ˆé¢ (React Component)
const PrintLayout = ({ quote }) => {
Â  const { company } = window.__APP_CONTEXT__ || {};
Â  const info = COMPANY_DATA[company || 'herhsin']; // ç¢ºä¿æœ‰é è¨­å€¼

Â  const total = calcTotal(quote.items || []);
Â  const negotiated = calcNegotiated(total, quote.discountPercent, quote.negotiatedPrice);

Â  let mainItemIndex = 1;

Â  return (
Â  Â  <div className="print-page">
Â  Â  Â  {/* æ¨™é¡Œå€ */}
Â  Â  Â  <div className="print-header mb-4">
Â  Â  Â  Â  <h1 className="mb-2">{info.name} - å·¥ç¨‹å ±åƒ¹å–®</h1>
Â  Â  Â  </div>

Â  Â  Â  {/* å…¬å¸/å®¢æˆ¶è³‡è¨Šè¡¨æ ¼ */}
Â  Â  Â  <table className="print-info-table">
Â  Â  Â  Â  <tbody>
Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  <td className="print-info-label">å®¢æˆ¶åç¨±</td>
Â  Â  Â  Â  Â  Â  <td>{quote.customerName || 'N/A'}</td>
Â  Â  Â  Â  Â  Â  <td className="print-info-label">è¯çµ¡äºº</td>
Â  Â  Â  Â  Â  Â  <td>{quote.contact || 'N/A'}</td>
Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  <td className="print-info-label">å·¥ç¨‹åç¨±</td>
Â  Â  Â  Â  Â  Â  <td colSpan="3">{quote.title || 'N/A'}</td>
Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  <td className="print-info-label">å·¥ç¨‹åœ°é»</td>
Â  Â  Â  Â  Â  Â  <td colSpan="3">{quote.location || 'N/A'}</td>
Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  <td className="print-info-label">å ±åƒ¹æ—¥æœŸ</td>
Â  Â  Â  Â  Â  Â  <td>{quote.date || formatDate()}</td>
Â  Â  Â  Â  Â  Â  <td className="print-info-label">å ±åƒ¹ç·¨è™Ÿ</td>
Â  Â  Â  Â  Â  Â  <td>{quote.quoteNo || 'N/A'}</td>
Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  </tbody>
Â  Â  Â  </table>

Â  Â  Â  {/* å ±åƒ¹é …ç›®è¡¨æ ¼ */}
Â  Â  Â  <table className="print-items-table">
Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  <th style={{ width: '5%' }}>é …æ¬¡</th>
Â  Â  Â  Â  Â  Â  <th style={{ width: '25%' }}>å“å</th>
Â  Â  Â  Â  Â  Â  <th style={{ width: '30%' }}>è¦æ ¼/èªªæ˜</th>
Â  Â  Â  Â  Â  Â  <th style={{ width: '8%' }}>å–®ä½</th>
Â  Â  Â  Â  Â  Â  <th style={{ width: '8%' }}>æ•¸é‡</th>
Â  Â  Â  Â  Â  Â  <th style={{ width: '12%' }}>å–®åƒ¹</th>
Â  Â  Â  Â  Â  Â  <th style={{ width: '12%' }}>é‡‘é¡</th>
Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  </thead>
Â  Â  Â  Â  <tbody>
Â  Â  Â  Â  Â  {/* æ¸²æŸ“æ‰€æœ‰å¤§é …å’Œå­é … */}
Â  Â  Â  Â  Â  {(quote.items || []).map(item => (
Â  Â  Â  Â  Â  Â  <PrintItemRow key={item.id} item={item} index={mainItemIndex++} isSub={false} />
Â  Â  Â  Â  Â  ))}
Â  Â  Â  Â  </tbody>
Â  Â  Â  </table>

Â  Â  Â  {/* ç¸½è¨ˆå€å¡Š */}
Â  Â  Â  <div className="print-total-box flex justify-between">
Â  Â  Â  Â  <div style={{ width: '40%' }}>
Â  Â  Â  Â  Â  <p className="font-bold mb-1">ç¸½è¨ˆï¼š(æ­¤å ±åƒ¹æœªå«ç¨…)</p>
Â  Â  Â  Â  Â  <p>è¨ˆç®—ç¸½é¡: ${formatMoney(total)}</p>
Â  Â  Â  Â  Â  {quote.discountPercent > 0 && <p>æŠ˜æ‰£: {quote.discountPercent}%</p>}
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div style={{ width: '60%', textAlign: 'right', borderLeft: '1px solid black', paddingLeft: '10px' }}>
Â  Â  Â  Â  Â  <h2 style={{ fontSize: '18px', fontWeight: 'bold', color: '#0056b3' }}>
Â  Â  Â  Â  Â  Â  æœ€çµ‚å ±åƒ¹ (æœªç¨…)ï¼šNT$ {formatMoney(negotiated)}
Â  Â  Â  Â  Â  </h2>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  Â  
Â  Â  Â  {/* å‚™è¨»åŠä»˜æ¬¾æ¢ä»¶ */}
Â  Â  Â  <div className="flex">
Â  Â  Â  Â  <div className="print-notes-box" style={{ width: '50%', marginRight: '10px' }}>
Â  Â  Â  Â  Â  <p className="font-bold mb-1 border-b pb-1">å‚™è¨»èªªæ˜</p>
Â  Â  Â  Â  Â  <pre style={{ whiteSpace: 'pre-wrap', fontFamily: 'inherit', margin: 0 }}>
Â  Â  Â  Â  Â  Â  {quote.notes || 'ç„¡å‚™è¨»'}
Â  Â  Â  Â  Â  </pre>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div className="print-notes-box" style={{ width: '50%' }}>
Â  Â  Â  Â  Â  <p className="font-bold mb-1 border-b pb-1">ä»˜æ¬¾æ¢ä»¶</p>
Â  Â  Â  Â  Â  <pre style={{ whiteSpace: 'pre-wrap', fontFamily: 'inherit', margin: 0 }}>
Â  Â  Â  Â  Â  Â  {quote.payment || 'ç„¡ä»˜æ¬¾æ¢ä»¶'}
Â  Â  Â  Â  Â  </pre>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>

Â  Â  Â  {/* ç°½ç« å€ */}
Â  Â  Â  <div style={{ display: 'flex', justifyContent: 'space-between', marginTop: '20px', borderTop: '1px dashed #ccc', paddingTop: '10px', fontSize: '12px' }}>
Â  Â  Â  Â  <div style={{ width: '45%' }}>
Â  Â  Â  Â  Â  **å ±åƒ¹å…¬å¸ (è“‹ç« å€)**
Â  Â  Â  Â  Â  <p>{info.name}</p>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div style={{ width: '45%', borderLeft: '1px dashed #ccc', paddingLeft: '10px' }}>
Â  Â  Â  Â  Â  **å®¢æˆ¶ç¢ºèªç°½ç« **
Â  Â  Â  Â  Â  <p>æ—¥æœŸ: ________</p>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>
Â  );
};


// P8 â€” Appï¼ˆä¸»è¦ä½ˆå±€ï¼‰ (æ–°å¢åˆ—å°æŒ‰éˆ•)
function App() {
Â  const { activeQuote, updateQuote, activeQuoteId } = React.useContext(AppContext);

Â  // å¦‚æœæ²’æœ‰å ±åƒ¹å–®ï¼Œé¡¯ç¤ºæç¤º
Â  if (!activeQuoteId) {
Â  Â  return (
Â  Â  Â  <div className="flex p-8 max-w-7xl mx-auto">
Â  Â  Â  Â  <div className="w-80 pr-8">
Â  Â  Â  Â  Â  <CompanySelector />
Â  Â  Â  Â  Â  <ModeSelector />
Â  Â  Â  Â  Â  <QuoteManager />
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div className="flex-1 bg-white p-6 shadow rounded text-center text-gray-500">
Â  Â  Â  Â  Â  è«‹å…ˆåœ¨å·¦å´å»ºç«‹æˆ–é¸æ“‡ä¸€ä»½å ±åƒ¹å–®ã€‚
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  );
Â  }

Â  return (
Â  Â  <div className="flex p-8 max-w-7xl mx-auto min-h-screen">
Â  Â  Â Â 
Â  Â  Â  {/* 1. å·¦å´æ¬„ï¼šå ±åƒ¹å–®ç®¡ç† + å·¥å…·æŒ‰éˆ• */}
Â  Â  Â  <div className="w-80 pr-8 no-print flex-shrink-0">
Â  Â  Â  Â  <CompanySelector />
Â  Â  Â  Â  <ModeSelector />

Â  Â  Â  Â  {/* æ–°å¢ åˆ—å° æŒ‰éˆ• */}
Â  Â  Â  Â  <PrintButton /> 

Â  Â  Â  Â  {/* æ–°å¢ Excel åŒ¯å‡ºæŒ‰éˆ• */}
Â  Â  Â  Â  <div className="mb-4">
Â  Â  Â  Â  Â  <ExcelExporter />
Â  Â  Â  Â  </div>
Â  Â  Â  Â  
Â  Â  Â  Â  <QuoteManager />
Â  Â  Â  </div>

Â  Â  Â  {/* 2. å³å´æ¬„ï¼šç·¨è¼¯å€ */}
Â  Â  Â  <div className="flex-1">
Â  Â  Â  Â  <QuoteEditor />
Â  Â  Â  Â  <ItemsEditor quote={activeQuote} updateQuote={updateQuote} />

Â  Â  Â  Â  {/* å‚™è¨»/ä»˜æ¬¾/ç¸½åƒ¹ - ä¿®æ­£ç‚ºç”±ä¸Šå¾€ä¸‹å †ç–Š */}
Â  Â  Â  Â  <div className="flex flex-col gap-6 no-print">
Â  Â  Â  Â  Â  <div className="flex-1">
Â  Â  Â  Â  Â  Â  <NotesEditor quote={activeQuote} update={updateQuote} />
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div className="flex-1">
Â  Â  Â  Â  Â  Â  <PaymentEditor quote={activeQuote} update={updateQuote} />
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  <div className="flex-1">
Â  Â  Â  Â  Â  Â  <PriceSummary quote={activeQuote} update={updateQuote} />
Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>
Â  Â  Â  </div>
Â  Â  </div>
Â  );
}

// P9 â€” Root Render
ReactDOM.createRoot(document.getElementById("root")).render(
Â  <AppProvider>
Â  Â  <App />
Â  </AppProvider>
);
</script>

<script src="https://unpkg.com/react-dom@18/umd/react-dom-server.browser.development.js"></script>

</body>
</html>
